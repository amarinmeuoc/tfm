define("block_itp/showItp",["exports","core/notification","core/templates","./commonFunctions"],(function(_exports,_notification,_templates,_commonFunctions){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=(token,customer,group,billid,firstname,lastname)=>{document.querySelector(".back").addEventListener("click",(e=>{linkAssFunctionEvent(e,token,customer,group,billid,firstname,lastname)}))};const linkAssFunctionEvent=(e,token,customer,group,billid,firstname,lastname)=>{e.preventDefault();const xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","block_itp_get_itp"),formData.append("moodlewsrestformat","json"),formData.append("params[0][orderby]","startdate"),formData.append("params[0][order]","ASC"),formData.append("params[0][customer]",customer),formData.append("params[0][group]",group),formData.append("params[0][billid]",billid),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr,firstname,lastname,token)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=()=>{onErrorFunction()}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))},onErrorFunction=()=>{window.console.log("Solicitud fallida")},onLoadFunction=(myXhr,firstname,lastname,token)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response),formattedData={token:token,user:{firstname:firstname,lastname:lastname,email:res.length>0?res[0].email:""},itp:res.map((item=>({id:item.id,coursename:item.coursename,duration:item.duration,startdate:item.startdate,shortcode:item.shortcode,courseId:item.courseid,groupid:item.groupid,customerid:item.customerid,billid:item.billid,email:item.email,enddate:item.enddate,location:item.location,classroom:item.classroom,schedule:item.schedule,attendance:item.attendance,assessment:item.assessment,lastupdate:item.lastupdate,courseUrl:item.courseUrl})))};showTemplateItp(formattedData)}},showTemplateItp=response=>{_templates.default.renderForPromise("block_itp/itp",response).then((_ref=>{let{html:html,js:js}=_ref;document.querySelector(".block_itp_content").innerHTML="",_templates.default.appendNodeContents(".block_itp_content",html,js)})).then((()=>{(0,_commonFunctions.sortITPTable)()})).catch((error=>(0,_notification.exception)(error)))}}));

//# sourceMappingURL=showItp.min.js.map