{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["export const init=(token)=>{\n    const bosubmit=document.querySelector('#fitem_id_bosubmit');\n    const selCustomer=document.querySelector('#id_selCustomer');\n    const groupSelect=document.querySelector('#id_selgroup');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n\n    bosubmit.classList.remove('row');\n\n        updateListTrainees(selCustomer,groupSelect,selListTrainees,token);\n    \ngroupSelect.addEventListener('change',(ev)=>{\n    updateListTrainees(selCustomer,groupSelect,selListTrainees,token);\n},token)\n\nselCustomer.addEventListener('change',(ev)=>{\n    let xhr = new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    \n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','block_itp_get_group');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customercode]',ev.target.options[ev.target.selectedIndex].value);\n    \n\n    xhr.send(formData);\n    xhr.onload = reloadGroup;\n    \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n},token);\n\n\n\nfunction reloadGroup(){\n    if (this.readyState=== 4 && this. status === 200){\n        if (this.response){\n            const list_group=JSON.parse(this.response);\n            \n            removeOptions(groupSelect);\n\n            list_group.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.id;\n                opt.textContent=obj.name;\n                groupSelect.appendChild(opt);\n            });\n            updateListTrainees(selCustomer,groupSelect,selListTrainees,token)\n        } \n    }\n}\n\n\n}\n\nconst updateListTrainees=(selCustomer,groupSelect,listTrainees,token)=>{\n    let xhr = new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    const selectedCustomer=selCustomer.options[selCustomer.selectedIndex].value;\n    const selectedGroup=groupSelect.options[groupSelect.selectedIndex].textContent;\n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','block_itp_get_trainee_list');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customercode]',selectedCustomer);\n    formData.append('params[0][groupname]',selectedGroup);\n    xhr.send(formData);\n    xhr.onload = ()=>{\n        reloadTraineeList(xhr,listTrainees)\n    };\n    \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\n\nconst reloadTraineeList=(xhr,listTrainees)=>{\n    if (xhr.readyState=== 4 && xhr. status === 200){\n        if (xhr.response){\n            const list_trainees=JSON.parse(xhr.response);\n            \n            removeOptions(listTrainees);\n\n            list_trainees.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.billid;\n                opt.textContent=obj.groupname+\"_\"+obj.billid+\" \"+obj.firstname+\", \"+obj.lastname;\n                listTrainees.appendChild(opt);\n            })\n\n            let activeSpan = document.querySelector('#fitem_id_list_trainees>div>div>span[role=\"option\"]');\n            if (activeSpan!==null){\n                activeSpan.setAttribute('data-value',(list_trainees.length===0)?'':list_trainees[0].billid);\n                const span=document.createElement('span');\n                span.setAttribute('aria-hidden',true);\n                span.textContent=\"Ã— \"\n                activeSpan.innerHTML=\"\";\n                activeSpan.appendChild(span);\n                activeSpan.innerHTML+= list_trainees[0].groupname+\"_\"+list_trainees[0].billid+\" \"+list_trainees[0].firstname+\", \"+list_trainees[0].lastname;\n            }\n            \n\n            \n        } \n    }\n}\n\nconst removeOptions=(selectElement) =>{\n    var i, L = selectElement.options.length - 1;\n    for(i = L; i >= 0; i--) {\n       selectElement.remove(i);\n    }\n }"],"names":["token","bosubmit","document","querySelector","selCustomer","groupSelect","selListTrainees","reloadGroup","this","readyState","status","response","list_group","JSON","parse","removeOptions","map","obj","opt","createElement","value","id","textContent","name","appendChild","updateListTrainees","classList","remove","addEventListener","ev","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","target","options","selectedIndex","send","onload","onerror","console","log","listTrainees","selectedCustomer","selectedGroup","reloadTraineeList","list_trainees","billid","groupname","firstname","lastname","activeSpan","setAttribute","length","span","innerHTML","selectElement","i"],"mappings":"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"}