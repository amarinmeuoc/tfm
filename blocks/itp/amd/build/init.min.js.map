{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["export const init=(token)=>{\n    const bosubmit=document.querySelector('#fitem_id_bosubmit');\n    const selCustomer=document.querySelector('#id_selCustomer');\n    const groupSelect=document.querySelector('#id_selgroup');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n    \n\n    bosubmit.classList.remove('row');\n    isElementLoaded('#fitem_id_list_trainees>div>div>span[role=\"option\"]').then((selector)=>{\n        updateListTrainees(selCustomer,groupSelect,selListTrainees,token);\n        groupSelect.addEventListener('change',(ev)=>{\n            updateListTrainees(selCustomer,groupSelect,selListTrainees,token);\n        },token);\n        selCustomer.addEventListener('change',(ev)=>{\n            let xhr = new XMLHttpRequest();\n            const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n            \n            xhr.open('POST',url,true);\n            const formData= new FormData();\n            formData.append('wstoken',token);\n            formData.append('wsfunction','block_itp_get_group');\n            formData.append('moodlewsrestformat','json');\n            formData.append('params[0][customercode]',ev.target.options[ev.target.selectedIndex].value);\n            \n        \n            xhr.send(formData);\n            xhr.onload = reloadGroup;\n            \n            xhr.onerror = function() {\n                window.console.log(\"Solicitud fallida\");\n            };\n        },token);\n    });\n        \n   \n\n\nfunction reloadGroup(){\n    if (this.readyState=== 4 && this. status === 200){\n        if (this.response){\n            const list_group=JSON.parse(this.response);\n            \n            removeOptions(groupSelect);\n\n            list_group.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.id;\n                opt.textContent=obj.name;\n                groupSelect.appendChild(opt);\n            });\n            updateListTrainees(selCustomer,groupSelect,selListTrainees,token)\n        } \n    }\n}\n\n\n}\n\nconst updateListTrainees=(selCustomer,groupSelect,listTrainees,token)=>{\n    let xhr = new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    const selectedCustomer=selCustomer.options[selCustomer.selectedIndex].value;\n    const selectedGroup=groupSelect.options[groupSelect.selectedIndex].textContent;\n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','block_itp_get_trainee_list');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customercode]',selectedCustomer);\n    formData.append('params[0][groupname]',selectedGroup);\n    xhr.send(formData);\n    xhr.onload = ()=>{\n        reloadTraineeList(xhr,listTrainees)\n    };\n    \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\n\nconst reloadTraineeList=(xhr,listTrainees)=>{\n    \n    if (xhr.readyState=== 4 && xhr. status === 200){\n        if (xhr.response){\n            const list_trainees=JSON.parse(xhr.response);\n            let selectedValue=listTrainees.value;\n            let selectedTrainee=list_trainees.filter(obj=>obj.billid===listTrainees.value)[0];\n            if (selectedTrainee===undefined){\n                if (list_trainees.length>0){\n                    selectedTrainee=list_trainees[0];\n                    selectedValue=selectedTrainee.billid;\n                } else {\n                    selectedTrainee='';\n                    selectedValue='';\n                }\n                    \n            }\n            \n            const option=document.createElement('option');\n            option.value=selectedValue;\n            option.textContent=selectedTrainee.groupname+\"_\"+selectedTrainee.billid+\" \"+selectedTrainee.firstname+\", \"+selectedTrainee.lastname;\n            removeOptions(listTrainees);\n            listTrainees.appendChild(option);\n            \n\n            list_trainees.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.billid;\n                opt.textContent=obj.groupname+\"_\"+obj.billid+\" \"+obj.firstname+\", \"+obj.lastname;\n                listTrainees.appendChild(opt);\n            })\n            \n            let activeSpan = document.querySelector('#fitem_id_list_trainees>div>div>span[role=\"option\"]');\n            if (activeSpan!==null){\n                activeSpan.setAttribute('data-value',(list_trainees.length===0)?'':list_trainees[0].billid);\n                const span=document.createElement('span');\n                span.setAttribute('aria-hidden',true);\n                span.textContent=\"Ã— \"\n                activeSpan.innerHTML=\"\";\n                activeSpan.appendChild(span);\n                activeSpan.innerHTML+= selectedTrainee.groupname+\"_\"+selectedTrainee.billid+\" \"+selectedTrainee.firstname+\", \"+selectedTrainee.lastname;\n            }\n            \n\n            \n        } \n    }\n}\n\nconst removeOptions=(selectElement) =>{\n    let i, L = selectElement.options.length - 1;\n    for(i = L; i >= 0; i--) {\n        selectElement.remove(i);\n    }\n }\n\n const isElementLoaded = async selector => {\n    while ( document.querySelector(selector) === null) {\n      await new Promise( resolve =>  requestAnimationFrame(resolve) )\n    }\n    return document.querySelector(selector);\n  };\n"],"names":["token","bosubmit","document","querySelector","selCustomer","groupSelect","selListTrainees","reloadGroup","this","readyState","status","response","list_group","JSON","parse","removeOptions","map","obj","opt","createElement","value","id","textContent","name","appendChild","updateListTrainees","classList","remove","isElementLoaded","then","selector","addEventListener","ev","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","target","options","selectedIndex","send","onload","onerror","console","log","listTrainees","selectedCustomer","selectedGroup","reloadTraineeList","list_trainees","selectedValue","selectedTrainee","filter","billid","undefined","length","option","groupname","firstname","lastname","activeSpan","setAttribute","span","innerHTML","selectElement","i","async","Promise","resolve","requestAnimationFrame"],"mappings":"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"}