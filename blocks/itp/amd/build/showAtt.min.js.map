{"version":3,"file":"showAtt.min.js","sources":["../src/showAtt.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const init = (token,email,firstname,lastname) => {\n    let linkatt=document.querySelectorAll('.linkatt');\n    if (linkatt.length>0 && linkatt!==null){\n      customer=linkatt[0].attributes.customer.value;\n      group=linkatt[0].attributes.group.value;\n      billid=linkatt[0].attributes.billid.value;\n      startdate=linkatt[0].attributes.startdate.value;\n      enddate=linkatt[0].attributes.enddate.value;\n\n      linkatt.forEach((link)=>{\n        link.addEventListener('click',(event)=>{\n          showAttendanceList(event,token,email,firstname,lastname);\n        });\n      });\n    } else  {\n      customer=null;\n      group=null;\n      billid=null;\n      startdate=null;\n      enddate=null;\n    }\n\n    \n};\n\nfunction showTemplateAssessment(response){\n  Templates.renderForPromise('block_itp/attendanceDetails',response)\n  .then(({html,js})=>{\n    const content=document.querySelector('.block_itp_content');\n    content.innerHTML='';\n    Templates.appendNodeContents('.block_itp_content',html,js);\n  })\n  .catch((error)=>displayException(error));\n}\n\nlet showAttendanceList=(e,token,email,firstname,lastname)=>{\n  e.preventDefault();\n  let courseid=e.target.attributes.courseid.value;\n  const xhr=new XMLHttpRequest();\n  const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n  xhr.open('POST',url,true);\n  const formData= new FormData();\n  formData.append('wstoken',token);\n  formData.append('wsfunction','block_itp_get_daily_attendance');\n  formData.append('moodlewsrestformat','json');\n  formData.append('params[0][courseid]',courseid);\n  formData.append('params[0][email]',email);\n  formData.append('params[0][startdate]',startdate);\n  formData.append('params[0][enddate]',enddate);\n\n  xhr.send(formData);\n    xhr.onload = (event) => {\n      onLoadFunction(xhr,firstname,lastname,token);\n    };\n    xhr.onprogress = (event)=>{\n      onProgressFunction(event);\n    };\n    \n    xhr.onerror = function() {\n      window.console.log(\"Solicitud fallida\");\n    };\n};\n\nconst onProgressFunction=(event)=> {\n  if (event.lengthComputable) {\n    window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n  } else {\n    window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n  }\n};\n\nconst onLoadFunction=(myxhr,firstname,lastname,token)=>{\n  if (myxhr.readyState=== 4 && myxhr.status === 200){\n    const res=JSON.parse(myxhr.response);\n    const formattedData = {\n      token:token,\n      customer:customer,\n      group:group,\n      billid:billid,\n      startdate:startdate,\n      enddate:enddate,\n      message:(res.length===0)?'No Absent or Late for this period of time. Please check another period or contact to the administrator':'',\n      user: {\n        firstname:firstname,\n        lastname:lastname\n      },\n      dailyAttendance: getAttendanceResults(res)\n    }\n    //There are no records\n    if (res.length===0){\n        formattedData.message=\"Waiting for attendance to be uploaded. Please, wait until attendance is uploaded.\"\n    } else {\n      const listofPresents=res.filter(elem=>{\n                                  return elem.description==='Present';\n                              });\n      if (listofPresents.length===res.length){\n        formattedData.message=\"The attendance for this course is 100%\";\n      } \n    \n    }\n    \n    showTemplateAssessment(formattedData);\n\n  }\n}\n\nconst getAttendanceResults=(res)=>{\n  return res.filter(item => {\n    // Customize object properties for the template as needed\n    const pattern=/Present/i;\n    return !pattern.test(item.description)\n  }).map(item=>{\n    return{\n      // Example:\n      courseid: item.courseid,\n      coursename: item.coursename,\n      shortname:item.shortname,\n      date:item.date,\n      firstname:item.firstname,\n      lastname:item.lastname,\n      description:item.description,\n      feedback:item.feedback,\n      // ... add other properties\n    };\n  })\n}"],"names":["token","email","firstname","lastname","linkatt","document","querySelectorAll","length","customer","attributes","value","group","billid","startdate","enddate","forEach","link","addEventListener","event","showAttendanceList","e","preventDefault","courseid","target","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","send","onload","onLoadFunction","onprogress","onProgressFunction","onerror","console","log","lengthComputable","loaded","total","myxhr","readyState","status","res","JSON","parse","response","formattedData","message","user","dailyAttendance","getAttendanceResults","filter","elem","description","renderForPromise","then","_ref","html","js","querySelector","innerHTML","appendNodeContents","catch","error","item","test","map","coursename","shortname","date","feedback"],"mappings":"0RAEoB,CAACA,MAAMC,MAAMC,UAAUC,gBACnCC,QAAQC,SAASC,iBAAiB,YAClCF,QAAQG,OAAO,GAAe,OAAVH,SACtBI,SAASJ,QAAQ,GAAGK,WAAWD,SAASE,MACxCC,MAAMP,QAAQ,GAAGK,WAAWE,MAAMD,MAClCE,OAAOR,QAAQ,GAAGK,WAAWG,OAAOF,MACpCG,UAAUT,QAAQ,GAAGK,WAAWI,UAAUH,MAC1CI,QAAQV,QAAQ,GAAGK,WAAWK,QAAQJ,MAEtCN,QAAQW,SAASC,OACfA,KAAKC,iBAAiB,SAASC,QAC7BC,mBAAmBD,MAAMlB,MAAMC,MAAMC,UAAUC,kBAInDK,SAAS,KACTG,MAAM,KACNC,OAAO,KACPC,UAAU,KACVC,QAAQ,WAgBVK,mBAAmB,CAACC,EAAEpB,MAAMC,MAAMC,UAAUC,YAC9CiB,EAAEC,qBACEC,SAASF,EAAEG,OAAOd,WAAWa,SAASZ,YACpCc,IAAI,IAAIC,eACRC,IAAIC,OAAOC,SAASC,SAAS,KAAKF,OAAOC,SAASE,SAAS,8BACjEN,IAAIO,KAAK,OAAOL,KAAI,SACdM,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAUlC,OAC1BgC,SAASE,OAAO,aAAa,kCAC7BF,SAASE,OAAO,qBAAqB,QACrCF,SAASE,OAAO,sBAAsBZ,UACtCU,SAASE,OAAO,mBAAmBjC,OACnC+B,SAASE,OAAO,uBAAuBrB,WACvCmB,SAASE,OAAO,qBAAqBpB,SAErCU,IAAIW,KAAKH,UACPR,IAAIY,OAAUlB,QACZmB,eAAeb,IAAItB,UAAUC,SAASH,QAExCwB,IAAIc,WAAcpB,QAChBqB,mBAAmBrB,QAGrBM,IAAIgB,QAAU,WACZb,OAAOc,QAAQC,IAAI,6BAInBH,mBAAoBrB,QACpBA,MAAMyB,iBACRhB,OAAOc,QAAQC,wBAAiBxB,MAAM0B,sBAAa1B,MAAM2B,iBAEzDlB,OAAOc,QAAQC,wBAAiBxB,MAAM0B,mBAIpCP,eAAe,CAACS,MAAM5C,UAAUC,SAASH,YACrB,IAApB8C,MAAMC,YAAoC,MAAjBD,MAAME,OAAe,OAC1CC,IAAIC,KAAKC,MAAML,MAAMM,UACrBC,cAAgB,CACpBrD,MAAMA,MACNQ,SAASA,SACTG,MAAMA,MACNC,OAAOA,OACPC,UAAUA,UACVC,QAAQA,QACRwC,QAAsB,IAAbL,IAAI1C,OAAY,yGAAyG,GAClIgD,KAAM,CACJrD,UAAUA,UACVC,SAASA,UAEXqD,gBAAiBC,qBAAqBR,SAGvB,IAAbA,IAAI1C,OACJ8C,cAAcC,QAAQ,wFACnB,CACgBL,IAAIS,QAAOC,MACsB,YAAnBA,KAAKC,cAErBrD,SAAS0C,IAAI1C,SAC9B8C,cAAcC,QAAQ,0CAvEEF,SA4ELC,iCA3EfQ,iBAAiB,8BAA8BT,UACxDU,MAAKC,WAACC,KAACA,KAADC,GAAMA,SACG5D,SAAS6D,cAAc,sBAC7BC,UAAU,sBACRC,mBAAmB,qBAAqBJ,KAAKC,OAExDI,OAAOC,QAAQ,2BAAiBA,aAPHlB,UAiF1BK,qBAAsBR,KACnBA,IAAIS,QAAOa,OAEF,WACEC,KAAKD,KAAKX,eACzBa,KAAIF,OACC,CAEJjD,SAAUiD,KAAKjD,SACfoD,WAAYH,KAAKG,WACjBC,UAAUJ,KAAKI,UACfC,KAAKL,KAAKK,KACV1E,UAAUqE,KAAKrE,UACfC,SAASoE,KAAKpE,SACdyD,YAAYW,KAAKX,YACjBiB,SAASN,KAAKM"}