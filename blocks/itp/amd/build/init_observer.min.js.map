{"version":3,"file":"init_observer.min.js","sources":["../src/init_observer.js"],"sourcesContent":["export const init=(token,customercode)=>{\n    const bosubmit=document.querySelector('#fitem_id_bosubmit');\n    \n    const groupSelect=document.querySelector('#id_selgroup');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n\n    bosubmit.classList.remove('row');\n    isElementLoaded('#fitem_id_list_trainees>div>div>span[role=\"option\"]').then((selector)=>{\n        removeOptions(selListTrainees);\n    \n        updateListTrainees(customercode,groupSelect,selListTrainees,token);\n    \n        groupSelect.addEventListener('change',(ev)=>{\n            updateListTrainees(customercode,groupSelect,selListTrainees,token);\n        },token,customercode)\n    });\n    \n\n\nfunction reloadGroup(){\n    if (this.readyState=== 4 && this. status === 200){\n        if (this.response){\n            const list_group=JSON.parse(this.response);\n            \n            removeOptions(groupSelect);\n\n            list_group.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.id;\n                opt.textContent=obj.name;\n                groupSelect.appendChild(opt);\n            });\n            updateListTrainees(customercode,groupSelect,selListTrainees,token)\n        } \n    }\n}\n\n\n}\n\nconst updateListTrainees=(customercode,groupSelect,listTrainees,token)=>{\n    let xhr = new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    const selectedCustomer=customercode;\n    const selectedGroup=groupSelect.options[groupSelect.selectedIndex].textContent;\n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','block_itp_get_trainee_list');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customercode]',selectedCustomer);\n    formData.append('params[0][groupname]',selectedGroup);\n    xhr.send(formData);\n    xhr.onload = ()=>{\n        reloadTraineeList(xhr,listTrainees)\n    };\n\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event,listTrainees);\n      } \n    \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onProgressFunction=(event,listTrainees)=>{\n    //removeOptions(listTrainees);\n}\n\nconst reloadTraineeList=(xhr,listTrainees)=>{\n    \n    if (xhr.readyState=== 4 && xhr. status === 200){\n        if (xhr.response){\n            const list_trainees=JSON.parse(xhr.response);\n            \n            let selectedValue=document.querySelectorAll('dd')[1].textContent.trim();\n            let selectedTrainee=list_trainees.filter(obj=>obj.billid===selectedValue)[0];\n            if (selectedTrainee===undefined){\n                if (list_trainees.length>0){\n                    selectedTrainee=list_trainees[0];\n                    selectedValue=selectedTrainee.billid;\n                } else {\n                    selectedTrainee='';\n                    selectedValue='';\n                } \n            }\n\n            \n            \n            const option=document.createElement('option');\n            option.value=selectedValue;\n            option.textContent=selectedTrainee.groupname+\"_\"+selectedTrainee.billid+\" \"+selectedTrainee.firstname+\", \"+selectedTrainee.lastname;\n            removeOptions(listTrainees);\n            listTrainees.appendChild(option);\n\n            list_trainees.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.billid;\n                opt.textContent=obj.groupname+\"_\"+obj.billid+\" \"+obj.firstname+\", \"+obj.lastname;\n                listTrainees.appendChild(opt);\n            })\n\n            let activeSpan = document.querySelector('#fitem_id_list_trainees>div>div>span[role=\"option\"]');\n            if (activeSpan!==null){\n                activeSpan.setAttribute('data-value',(list_trainees.length===0)?'':list_trainees[0].billid);\n                const span=document.createElement('span');\n                span.setAttribute('aria-hidden',true);\n                span.textContent=\"Ã— \"\n                activeSpan.innerHTML=\"\";\n                activeSpan.appendChild(span);\n                activeSpan.innerHTML+= selectedTrainee.groupname+\"_\"+selectedTrainee.billid+\" \"+selectedTrainee.firstname+\", \"+selectedTrainee.lastname;\n            } \n        } \n    }\n}\n\nconst removeOptions=(selectElement) =>{\n    let i, L = selectElement.options.length - 1;\n    for(i = L; i >= 0; i--) {\n       selectElement.remove(i);\n    }\n }\n\n const isElementLoaded = async selector => {\n    while ( document.querySelector(selector) === null) {\n      await new Promise( resolve =>  requestAnimationFrame(resolve) )\n    }\n    return document.querySelector(selector);\n  };"],"names":["token","customercode","bosubmit","document","querySelector","groupSelect","selListTrainees","classList","remove","isElementLoaded","then","selector","removeOptions","updateListTrainees","addEventListener","ev","listTrainees","xhr","XMLHttpRequest","url","window","location","protocol","hostname","selectedCustomer","selectedGroup","options","selectedIndex","textContent","open","formData","FormData","append","send","onload","reloadTraineeList","onprogress","event","onProgressFunction","onerror","console","log","readyState","status","response","list_trainees","JSON","parse","selectedValue","querySelectorAll","trim","selectedTrainee","filter","obj","billid","undefined","length","option","createElement","value","groupname","firstname","lastname","appendChild","map","opt","activeSpan","setAttribute","span","innerHTML","selectElement","i","async","Promise","resolve","requestAnimationFrame"],"mappings":"4JAAkB,CAACA,MAAMC,sBACfC,SAASC,SAASC,cAAc,sBAEhCC,YAAYF,SAASC,cAAc,gBACnCE,gBAAgBH,SAASC,cAAc,qBAE7CF,SAASK,UAAUC,OAAO,OAC1BC,gBAAgB,uDAAuDC,MAAMC,WACzEC,cAAcN,iBAEdO,mBAAmBZ,aAAaI,YAAYC,gBAAgBN,OAE5DK,YAAYS,iBAAiB,UAAUC,KACnCF,mBAAmBZ,aAAaI,YAAYC,gBAAgBN,SAC9DA,MAAMC,wBA0BVY,mBAAmB,CAACZ,aAAaI,YAAYW,aAAahB,aACxDiB,IAAM,IAAIC,qBACRC,IAAIC,OAAOC,SAASC,SAAS,KAAKF,OAAOC,SAASE,SAAS,8BAC3DC,iBAAiBvB,aACjBwB,cAAcpB,YAAYqB,QAAQrB,YAAYsB,eAAeC,YACnEX,IAAIY,KAAK,OAAOV,KAAI,SACdW,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAUhC,OAC1B8B,SAASE,OAAO,aAAa,8BAC7BF,SAASE,OAAO,qBAAqB,QACrCF,SAASE,OAAO,0BAA0BR,kBAC1CM,SAASE,OAAO,uBAAuBP,eACvCR,IAAIgB,KAAKH,UACTb,IAAIiB,OAAS,KACTC,kBAAkBlB,IAAID,eAG1BC,IAAImB,WAAcC,QACdC,mBAAmBD,MAAMrB,eAG7BC,IAAIsB,QAAU,WACVnB,OAAOoB,QAAQC,IAAI,uBAIrBH,mBAAmB,CAACD,MAAMrB,kBAI1BmB,kBAAkB,CAAClB,IAAID,mBAEH,IAAlBC,IAAIyB,YAAmC,MAAhBzB,IAAK0B,QACxB1B,IAAI2B,SAAS,OACPC,cAAcC,KAAKC,MAAM9B,IAAI2B,cAE/BI,cAAc7C,SAAS8C,iBAAiB,MAAM,GAAGrB,YAAYsB,OAC7DC,gBAAgBN,cAAcO,QAAOC,KAAKA,IAAIC,SAASN,gBAAe,QACpDO,IAAlBJ,kBACIN,cAAcW,OAAO,GACrBL,gBAAgBN,cAAc,GAC9BG,cAAcG,gBAAgBG,SAE9BH,gBAAgB,GAChBH,cAAc,WAMhBS,OAAOtD,SAASuD,cAAc,UACpCD,OAAOE,MAAMX,cACbS,OAAO7B,YAAYuB,gBAAgBS,UAAU,IAAIT,gBAAgBG,OAAO,IAAIH,gBAAgBU,UAAU,KAAKV,gBAAgBW,SAC3HlD,cAAcI,cACdA,aAAa+C,YAAYN,QAEzBZ,cAAcmB,KAAIX,YACRY,IAAI9D,SAASuD,cAAc,UACjCO,IAAIN,MAAMN,IAAIC,OACdW,IAAIrC,YAAYyB,IAAIO,UAAU,IAAIP,IAAIC,OAAO,IAAID,IAAIQ,UAAU,KAAKR,IAAIS,SACxE9C,aAAa+C,YAAYE,YAGzBC,WAAa/D,SAASC,cAAc,0DACvB,OAAb8D,WAAkB,CAClBA,WAAWC,aAAa,aAAqC,IAAvBtB,cAAcW,OAAY,GAAGX,cAAc,GAAGS,cAC9Ec,KAAKjE,SAASuD,cAAc,QAClCU,KAAKD,aAAa,eAAc,GAChCC,KAAKxC,YAAY,KACjBsC,WAAWG,UAAU,GACrBH,WAAWH,YAAYK,MACvBF,WAAWG,WAAYlB,gBAAgBS,UAAU,IAAIT,gBAAgBG,OAAO,IAAIH,gBAAgBU,UAAU,KAAKV,gBAAgBW,YAMzIlD,cAAe0D,oBACbC,MACAA,EADOD,cAAc5C,QAAQ8B,OAAS,EAC/Be,GAAK,EAAGA,IAChBD,cAAc9D,OAAO+D,IAIrB9D,gBAAkB+D,MAAAA,gBACwB,OAArCrE,SAASC,cAAcO,iBACvB,IAAI8D,SAASC,SAAYC,sBAAsBD,kBAEhDvE,SAASC,cAAcO"}