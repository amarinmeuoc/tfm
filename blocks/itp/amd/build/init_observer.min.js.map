{"version":3,"file":"init_observer.min.js","sources":["../src/init_observer.js"],"sourcesContent":["export const init=(token,customercode)=>{\n    const bosubmit=document.querySelector('#fitem_id_bosubmit');\n    \n    const groupSelect=document.querySelector('#id_selgroup');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n\n    bosubmit.classList.remove('row');\n\n    \n        \n        window.console.log(\"hola\");\n        updateListTrainees(customercode,groupSelect,selListTrainees,token);\n    \ngroupSelect.addEventListener('change',(ev)=>{\n    updateListTrainees(customercode,groupSelect,selListTrainees,token);\n},token,customercode)\n\n\nfunction reloadGroup(){\n    if (this.readyState=== 4 && this. status === 200){\n        if (this.response){\n            const list_group=JSON.parse(this.response);\n            \n            removeOptions(groupSelect);\n\n            list_group.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.id;\n                opt.textContent=obj.name;\n                groupSelect.appendChild(opt);\n            });\n            updateListTrainees(customercode,groupSelect,selListTrainees,token)\n        } \n    }\n}\n\n\n}\n\nconst updateListTrainees=(customercode,groupSelect,listTrainees,token)=>{\n    let xhr = new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    const selectedCustomer=customercode;\n    const selectedGroup=groupSelect.options[groupSelect.selectedIndex].textContent;\n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','block_itp_get_trainee_list');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customercode]',selectedCustomer);\n    formData.append('params[0][groupname]',selectedGroup);\n    xhr.send(formData);\n    xhr.onload = ()=>{\n        reloadTraineeList(xhr,listTrainees)\n    };\n    \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\n\nconst reloadTraineeList=(xhr,listTrainees)=>{\n    if (xhr.readyState=== 4 && xhr. status === 200){\n        if (xhr.response){\n            const list_trainees=JSON.parse(xhr.response);\n            window.console.log(list_trainees);\n            removeOptions(listTrainees);\n\n            list_trainees.map(obj=>{\n                const opt=document.createElement('option');\n                opt.value=obj.billid;\n                opt.textContent=obj.groupname+\"_\"+obj.billid+\" \"+obj.firstname+\", \"+obj.lastname;\n                listTrainees.appendChild(opt);\n            })\n\n            let activeSpan = document.querySelector('#fitem_id_list_trainees>div>div>span[role=\"option\"]');\n            if (activeSpan!==null && list_trainees.length>0){\n                activeSpan.setAttribute('data-value',(list_trainees.length===0)?'':list_trainees[0].billid);\n                const span=document.createElement('span');\n                span.setAttribute('aria-hidden',true);\n                span.textContent=\"Ã— \"\n                activeSpan.innerHTML=\"\";\n                activeSpan.appendChild(span);\n                activeSpan.innerHTML+= list_trainees[0].groupname+\"_\"+list_trainees[0].billid+\" \"+list_trainees[0].firstname+\", \"+list_trainees[0].lastname;\n            }\n            \n\n            \n        } \n    }\n}\n\nconst removeOptions=(selectElement) =>{\n    var i, L = selectElement.options.length - 1;\n    for(i = L; i >= 0; i--) {\n       selectElement.remove(i);\n    }\n }"],"names":["token","customercode","bosubmit","document","querySelector","groupSelect","selListTrainees","classList","remove","window","console","log","updateListTrainees","addEventListener","ev","listTrainees","xhr","XMLHttpRequest","url","location","protocol","hostname","selectedCustomer","selectedGroup","options","selectedIndex","textContent","open","formData","FormData","append","send","onload","reloadTraineeList","onerror","readyState","status","response","list_trainees","JSON","parse","removeOptions","map","obj","opt","createElement","value","billid","groupname","firstname","lastname","appendChild","activeSpan","length","setAttribute","span","innerHTML","selectElement","i"],"mappings":"4JAAkB,CAACA,MAAMC,sBACfC,SAASC,SAASC,cAAc,sBAEhCC,YAAYF,SAASC,cAAc,gBACnCE,gBAAgBH,SAASC,cAAc,qBAE7CF,SAASK,UAAUC,OAAO,OAItBC,OAAOC,QAAQC,IAAI,QACnBC,mBAAmBX,aAAaI,YAAYC,gBAAgBN,OAEpEK,YAAYQ,iBAAiB,UAAUC,KACnCF,mBAAmBX,aAAaI,YAAYC,gBAAgBN,SAC9DA,MAAMC,qBAwBFW,mBAAmB,CAACX,aAAaI,YAAYU,aAAaf,aACxDgB,IAAM,IAAIC,qBACRC,IAAIT,OAAOU,SAASC,SAAS,KAAKX,OAAOU,SAASE,SAAS,8BAC3DC,iBAAiBrB,aACjBsB,cAAclB,YAAYmB,QAAQnB,YAAYoB,eAAeC,YACnEV,IAAIW,KAAK,OAAOT,KAAI,SACdU,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAU9B,OAC1B4B,SAASE,OAAO,aAAa,8BAC7BF,SAASE,OAAO,qBAAqB,QACrCF,SAASE,OAAO,0BAA0BR,kBAC1CM,SAASE,OAAO,uBAAuBP,eACvCP,IAAIe,KAAKH,UACTZ,IAAIgB,OAAS,KACTC,kBAAkBjB,IAAID,eAG1BC,IAAIkB,QAAU,WACVzB,OAAOC,QAAQC,IAAI,uBAKrBsB,kBAAkB,CAACjB,IAAID,mBACH,IAAlBC,IAAImB,YAAmC,MAAhBnB,IAAKoB,QACxBpB,IAAIqB,SAAS,OACPC,cAAcC,KAAKC,MAAMxB,IAAIqB,UACnC5B,OAAOC,QAAQC,IAAI2B,eACnBG,cAAc1B,cAEduB,cAAcI,KAAIC,YACRC,IAAIzC,SAAS0C,cAAc,UACjCD,IAAIE,MAAMH,IAAII,OACdH,IAAIlB,YAAYiB,IAAIK,UAAU,IAAIL,IAAII,OAAO,IAAIJ,IAAIM,UAAU,KAAKN,IAAIO,SACxEnC,aAAaoC,YAAYP,YAGzBQ,WAAajD,SAASC,cAAc,0DACvB,OAAbgD,YAAqBd,cAAce,OAAO,EAAE,CAC5CD,WAAWE,aAAa,aAAqC,IAAvBhB,cAAce,OAAY,GAAGf,cAAc,GAAGS,cAC9EQ,KAAKpD,SAAS0C,cAAc,QAClCU,KAAKD,aAAa,eAAc,GAChCC,KAAK7B,YAAY,KACjB0B,WAAWI,UAAU,GACrBJ,WAAWD,YAAYI,MACvBH,WAAWI,WAAYlB,cAAc,GAAGU,UAAU,IAAIV,cAAc,GAAGS,OAAO,IAAIT,cAAc,GAAGW,UAAU,KAAKX,cAAc,GAAGY,YAS7IT,cAAegB,oBACbC,MACAA,EADOD,cAAcjC,QAAQ6B,OAAS,EAC/BK,GAAK,EAAGA,IAChBD,cAAcjD,OAAOkD"}