{"version":3,"file":"showAss.min.js","sources":["../src/showAss.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const init = (token,email,firstname,lastname) => {\n    let linkass=document.querySelectorAll('.linkass');\n    let customer,group,billid;\n\n    //Show the assessment in detail\n    const showAssessmentList=(event)=>{\n      showAssessmentListFunction(event,token,email,firstname,lastname);\n    };\n\n    if (linkass.length>0 && linkass!==null){\n      customer=linkass[0].attributes.customer.value;\n      group=linkass[0].attributes.group.value;\n      billid=linkass[0].attributes.billid.value;\n\n      linkass.forEach((link)=>{\n        link.addEventListener('click',showAssessmentList);\n      });\n    } else  {\n      customer=null;\n      group=null;\n      billid=null;\n    }\n};\n\nconst showAssessmentListFunction=(e,token,email,firstname,lastname)=>{\n\n  e.preventDefault();\n  let courseid=e.target.attributes.courseid.value;\n  const xhr=new XMLHttpRequest();\n  const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n  xhr.open('POST',url,true);\n  const formData= new FormData();\n  formData.append('wstoken',token);\n  formData.append('wsfunction','block_itp_get_assessment_details');\n  formData.append('moodlewsrestformat','json');\n  formData.append('params[0][courseid]',courseid);\n  formData.append('params[0][email]',email);\n\n  xhr.send(formData);\n  xhr.onload = (event) =>{\n    onLoadFunction(xhr,firstname,lastname,token);\n    };\n  xhr.onprogress = (event)=>{\n    onProgressFunction(event);\n  } \n  xhr.onerror = function() {\n    window.console.log(\"Solicitud fallida\");\n  };\n}\n\nconst onLoadFunction=(myXhr,firstname,lastname,token)=>{\n  if (myXhr.readyState=== 4 && myXhr. status === 200){\n    const res=JSON.parse(myXhr.response);\n    const formattedData = {\n      token:token,\n      customer:customer,\n      group:group,\n      billid:billid,\n      user: {\n        firstname:firstname,\n        lastname:lastname\n      },\n      assessmentDetails: res.map(item => {\n        // Customize object properties for the template as needed\n        return {\n          // Example:\n          kpi: item.kpi,\n          id: item.id,\n          coursename:item.coursename,\n          type:item.type,\n          score:item.score,\n          feedback: item.feedback,\n          timemodified:item.timemodified\n          // ... add other properties\n        };\n      })\n    };\n    showTemplateAssessment(formattedData);\n}\n}\n\nconst onProgressFunction= (event)=>{\n    if (event.lengthComputable) {\n      window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n    } else {\n      window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n    }\n}\n\nfunction showTemplateAssessment(response){\n  //Render the choosen mustache template by Javascript\n  Templates.renderForPromise('block_itp/assessmentDetails',response)\n  .then(({html,js})=>{\n    const content=document.querySelector('.block_itp_content');\n    content.innerHTML='';\n    Templates.appendNodeContents('.block_itp_content',html,js);\n    \n  })\n  .catch((error)=>displayException(error));\n}"],"names":["token","email","firstname","lastname","customer","group","billid","linkass","document","querySelectorAll","showAssessmentList","event","showAssessmentListFunction","length","attributes","value","forEach","link","addEventListener","e","preventDefault","courseid","target","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","send","onload","onLoadFunction","onprogress","onProgressFunction","onerror","console","log","myXhr","readyState","status","res","JSON","parse","response","formattedData","user","assessmentDetails","map","item","kpi","id","coursename","type","score","feedback","timemodified","renderForPromise","then","_ref","html","js","querySelector","innerHTML","appendNodeContents","catch","error","lengthComputable","loaded","total"],"mappings":"0RAEoB,CAACA,MAAMC,MAAMC,UAAUC,gBAEnCC,SAASC,MAAMC,OADfC,QAAQC,SAASC,iBAAiB,kBAIhCC,mBAAoBC,QACxBC,2BAA2BD,MAAMX,MAAMC,MAAMC,UAAUC,WAGrDI,QAAQM,OAAO,GAAe,OAAVN,SACtBH,SAASG,QAAQ,GAAGO,WAAWV,SAASW,MACxCV,MAAME,QAAQ,GAAGO,WAAWT,MAAMU,MAClCT,OAAOC,QAAQ,GAAGO,WAAWR,OAAOS,MAEpCR,QAAQS,SAASC,OACfA,KAAKC,iBAAiB,QAAQR,yBAGhCN,SAAS,KACTC,MAAM,KACNC,OAAO,aAIPM,2BAA2B,CAACO,EAAEnB,MAAMC,MAAMC,UAAUC,YAExDgB,EAAEC,qBACEC,SAASF,EAAEG,OAAOR,WAAWO,SAASN,YACpCQ,IAAI,IAAIC,eACRC,IAAIC,OAAOC,SAASC,SAAS,KAAKF,OAAOC,SAASE,SAAS,8BACjEN,IAAIO,KAAK,OAAOL,KAAI,SACdM,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAUjC,OAC1B+B,SAASE,OAAO,aAAa,oCAC7BF,SAASE,OAAO,qBAAqB,QACrCF,SAASE,OAAO,sBAAsBZ,UACtCU,SAASE,OAAO,mBAAmBhC,OAEnCsB,IAAIW,KAAKH,UACTR,IAAIY,OAAUxB,QACZyB,eAAeb,IAAIrB,UAAUC,SAASH,QAExCuB,IAAIc,WAAc1B,QAChB2B,mBAAmB3B,QAErBY,IAAIgB,QAAU,WACZb,OAAOc,QAAQC,IAAI,uBAIjBL,eAAe,CAACM,MAAMxC,UAAUC,SAASH,YACrB,IAApB0C,MAAMC,YAAqC,MAAlBD,MAAOE,OAAe,OAC3CC,IAAIC,KAAKC,MAAML,MAAMM,UACrBC,cAAgB,CACpBjD,MAAMA,MACNI,SAASA,SACTC,MAAMA,MACNC,OAAOA,OACP4C,KAAM,CACJhD,UAAUA,UACVC,SAASA,UAEXgD,kBAAmBN,IAAIO,KAAIC,OAElB,CAELC,IAAKD,KAAKC,IACVC,GAAIF,KAAKE,GACTC,WAAWH,KAAKG,WAChBC,KAAKJ,KAAKI,KACVC,MAAML,KAAKK,MACXC,SAAUN,KAAKM,SACfC,aAAaP,KAAKO,kBAiBIZ,SAZLC,iCAcfY,iBAAiB,8BAA8Bb,UACxDc,MAAKC,WAACC,KAACA,KAADC,GAAMA,SACGzD,SAAS0D,cAAc,sBAC7BC,UAAU,sBACRC,mBAAmB,qBAAqBJ,KAAKC,OAGxDI,OAAOC,QAAQ,2BAAiBA,aATHtB,UAR1BV,mBAAqB3B,QACnBA,MAAM4D,iBACR7C,OAAOc,QAAQC,wBAAiB9B,MAAM6D,sBAAa7D,MAAM8D,iBAEzD/C,OAAOc,QAAQC,wBAAiB9B,MAAM6D"}