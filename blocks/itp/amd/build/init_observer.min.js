define("block_itp/init_observer",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(token,customercode)=>{const bosubmit=document.querySelector("#fitem_id_bosubmit"),groupSelect=document.querySelector("#id_selgroup"),selListTrainees=document.querySelector("#id_list_trainees");bosubmit.classList.remove("row"),isElementLoaded('#fitem_id_list_trainees>div>div>span[role="option"]').then((selector=>{removeOptions(selListTrainees),updateListTrainees(customercode,groupSelect,selListTrainees,token),groupSelect.addEventListener("change",(ev=>{updateListTrainees(customercode,groupSelect,selListTrainees,token)}),token,customercode)}))};const updateListTrainees=(customercode,groupSelect,listTrainees,token)=>{let xhr=new XMLHttpRequest;const url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php",selectedCustomer=customercode,selectedGroup=groupSelect.options[groupSelect.selectedIndex].textContent;xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","block_itp_get_trainee_list"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customercode]",selectedCustomer),formData.append("params[0][groupname]",selectedGroup),xhr.send(formData),xhr.onload=()=>{reloadTraineeList(xhr,listTrainees)},xhr.onprogress=event=>{onProgressFunction(event,listTrainees)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onProgressFunction=(event,listTrainees)=>{},reloadTraineeList=(xhr,listTrainees)=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){const list_trainees=JSON.parse(xhr.response);let selectedValue=document.querySelectorAll("dd")[1].textContent.trim(),selectedTrainee=list_trainees.filter((obj=>obj.billid===selectedValue))[0];void 0===selectedTrainee&&(list_trainees.length>0?(selectedTrainee=list_trainees[0],selectedValue=selectedTrainee.billid):(selectedTrainee="",selectedValue=""));const option=document.createElement("option");option.value=selectedValue,option.textContent=selectedTrainee.groupname+"_"+selectedTrainee.billid+" "+selectedTrainee.firstname+", "+selectedTrainee.lastname,removeOptions(listTrainees),listTrainees.appendChild(option),list_trainees.map((obj=>{const opt=document.createElement("option");opt.value=obj.billid,opt.textContent=obj.groupname+"_"+obj.billid+" "+obj.firstname+", "+obj.lastname,listTrainees.appendChild(opt)}));let activeSpan=document.querySelector('#fitem_id_list_trainees>div>div>span[role="option"]');if(null!==activeSpan){activeSpan.setAttribute("data-value",0===list_trainees.length?"":list_trainees[0].billid);const span=document.createElement("span");span.setAttribute("aria-hidden",!0),span.textContent="Ã— ",activeSpan.innerHTML="",activeSpan.appendChild(span),activeSpan.innerHTML+=selectedTrainee.groupname+"_"+selectedTrainee.billid+" "+selectedTrainee.firstname+", "+selectedTrainee.lastname}}},removeOptions=selectElement=>{let i;for(i=selectElement.options.length-1;i>=0;i--)selectElement.remove(i)},isElementLoaded=async selector=>{for(;null===document.querySelector(selector);)await new Promise((resolve=>requestAnimationFrame(resolve)));return document.querySelector(selector)}}));

//# sourceMappingURL=init_observer.min.js.map