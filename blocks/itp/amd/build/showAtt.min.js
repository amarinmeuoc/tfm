define("block_itp/showAtt",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=(token,email,firstname,lastname)=>{let linkatt=document.querySelectorAll(".linkatt");linkatt.length>0&&null!==linkatt?(customer=linkatt[0].attributes.customer.value,group=linkatt[0].attributes.group.value,billid=linkatt[0].attributes.billid.value,linkatt.forEach((link=>{link.addEventListener("click",(event=>{showAttendanceList(event,token,email,firstname,lastname)}))}))):(customer=null,group=null,billid=null,startdate=null,enddate=null)};let showAttendanceList=(e,token,email,firstname,lastname)=>{e.preventDefault();let courseid=e.target.attributes.courseid.value;const startdate=e.target.attributes.startdate.value,enddate=e.target.attributes.enddate.value,xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","block_itp_get_daily_attendance"),formData.append("moodlewsrestformat","json"),formData.append("params[0][courseid]",courseid),formData.append("params[0][email]",email),formData.append("params[0][startdate]",startdate),formData.append("params[0][enddate]",enddate),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr,firstname,lastname,token,startdate,enddate)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}};const onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))},onLoadFunction=(myxhr,firstname,lastname,token,startdate,enddate)=>{if(4===myxhr.readyState&&200===myxhr.status){const res=JSON.parse(myxhr.response),formattedData={token:token,customer:customer,group:group,billid:billid,startdate:startdate,enddate:enddate,message:0===res.length?"No Absent or Late for this period of time. Please check another period or contact to the administrator":"",user:{firstname:firstname,lastname:lastname},dailyAttendance:getAttendanceResults(res)};if(0===res.length)formattedData.message="Waiting for attendance to be uploaded. Please, wait until attendance is uploaded.";else{res.filter((elem=>"Present"===elem.description)).length===res.length&&(formattedData.message="The attendance for this course is 100%")}response=formattedData,_templates.default.renderForPromise("block_itp/attendanceDetails",response).then((_ref=>{let{html:html,js:js}=_ref;document.querySelector(".block_itp_content").innerHTML="",_templates.default.appendNodeContents(".block_itp_content",html,js)})).catch((error=>(0,_notification.exception)(error)))}var response},getAttendanceResults=res=>res.filter((item=>!/Present/i.test(item.description))).map((item=>({courseid:item.courseid,coursename:item.coursename,shortname:item.shortname,date:item.date,firstname:item.firstname,lastname:item.lastname,description:item.description,feedback:item.feedback})))}));

//# sourceMappingURL=showAtt.min.js.map