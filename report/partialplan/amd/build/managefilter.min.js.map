{"version":3,"file":"managefilter.min.js","sources":["../src/managefilter.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nexport const init = (customerid,order,orderby,orderbystartdate,orderbyenddate) => {\n    let bofilter=document.querySelector('#bofilter');\n    let sdlink=document.querySelector('#sd-link');\n    let edlink=document.querySelector('#ed-link');\n\n    bofilter.addEventListener('click',()=>{\n        let day=document.querySelector('#id_assesstimefinish_day').value;\n        let month=document.querySelector('#id_assesstimefinish_month').value;\n        let year=document.querySelector('#id_assesstimefinish_year').value;\n        let group=document.querySelector('#selgroupid').value;\n        let billid=document.querySelector('#tebillid').value;\n        let date=new Date(year,month-1,day);\n        let unixtime=date.getTime()/1000;\n        \n        requestResultFromServer(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate);\n    });\n\n    sdlink.addEventListener('click',(e)=>{\n        e.preventDefault();\n        let day=document.querySelector('#id_assesstimefinish_day').value;\n        let month=document.querySelector('#id_assesstimefinish_month').value;\n        let year=document.querySelector('#id_assesstimefinish_year').value;\n        let group=document.querySelector('#selgroupid').value;\n        let billid=document.querySelector('#tebillid').value;\n        let date=new Date(year,month-1,day);\n        let unixtime=date.getTime()/1000;\n        orderbystartdate=true;\n        orderbyenddate=false;\n        orderby='startdate';\n        order=order?false:true;\n        \n        requestResultFromServer(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate);\n    });\n\n    edlink.addEventListener('click',(e)=>{\n        e.preventDefault();\n        let day=document.querySelector('#id_assesstimefinish_day').value;\n        let month=document.querySelector('#id_assesstimefinish_month').value;\n        let year=document.querySelector('#id_assesstimefinish_year').value;\n        let group=document.querySelector('#selgroupid').value;\n        let billid=document.querySelector('#tebillid').value;\n        let date=new Date(year,month-1,day);\n        let unixtime=date.getTime()/1000;\n        orderbyenddate=true;\n        orderbystartdate=true;\n        orderby='enddate';\n        order=order?false:true;\n        \n        requestResultFromServer(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate);\n    });\n    \n}\n\nconst requestResultFromServer=(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate)=>{\n    let xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    const token=document.querySelector('#id_token').value;\n    xhr.open('POST',url,true);\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_partialplan_get_training_plan');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][group]',parseInt(group));\n    formData.append('params[0][billid]',billid);\n    formData.append('params[0][unixtime]',unixtime);\n    formData.append('params[0][order]',(order)?1:0);\n    formData.append('params[0][orderby]',orderby);\n    formData.append('params[0][orderbystartdate]',(orderbystartdate)?1:0);\n    formData.append('params[0][orderbyenddate]',(orderbyenddate)?1:0);\n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr,group,token);\n        };\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onLoadFunction=(myXhr,selectedGroup,token)=>{\n    if (myXhr.readyState===4 && myXhr.status===200){\n        const res=JSON.parse(myXhr.response);\n        const formattedData={\n            token:token,\n            customerid:res[0].customerid,\n            group:res[0].group,\n            selectedGroup:selectedGroup,\n            courses:res[0].courses,\n            orderbystartdate:(res[0].orderbystartdate),\n            orderbyenddate:(res[0].orderbyenddate),\n            orderby:res[0].orderby,\n            order:(res[0].order),\n            minstartdate:(res[0].minstartdate),\n            maxenddate:(res[0].maxenddate)\n        }\n        \n        showTemplateAssessment(formattedData);\n    }\n}\n\nconst onProgressFunction= (event)=>{\n    if (event.lengthComputable) {\n      window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n    } else {\n      window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n    }\n}\n\nfunction showTemplateAssessment(response){\n    \n\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_partialplan/content',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n      const selectGroup=document.querySelector('#selgroupid');\n      const idsActuales=Array.from(selectGroup.options).map(option => option.value);\n      const desiredValue = response.selectedGroup;\n      //Checking if the user press submit first to ensure he updated the table\n      const encontrado=idsActuales.find(elem=>elem===desiredValue);\n      let optionIndex=0;\n      if (encontrado){\n        for (let i = 0; i < selectGroup.options.length; i++) {\n            if (selectGroup.options[i].value === desiredValue) {\n                optionIndex = i;\n                \n                break;\n            }\n        }\n    \n        selectGroup.selelectedIndex=optionIndex;\n        selectGroup.value=desiredValue;\n      } else {\n        const form=document.querySelector('#filterformid');\n        alert(\"Make sure you press submit before you filter\");\n        form.submit();\n      }\n      \n    \n\n    })\n    .catch((error)=>displayException(error));\n  }"],"names":["customerid","order","orderby","orderbystartdate","orderbyenddate","bofilter","document","querySelector","sdlink","edlink","addEventListener","day","value","month","year","group","billid","unixtime","Date","getTime","requestResultFromServer","e","preventDefault","xhr","XMLHttpRequest","url","window","location","protocol","hostname","token","open","formData","FormData","append","parseInt","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","console","log","myXhr","selectedGroup","readyState","status","res","JSON","parse","response","formattedData","courses","minstartdate","maxenddate","renderForPromise","then","_ref","html","js","content","innerHTML","appendNodeContents","selectGroup","idsActuales","Array","from","options","map","option","desiredValue","optionIndex","find","elem","i","length","selelectedIndex","form","alert","submit","catch","error","lengthComputable","loaded","total"],"mappings":"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"}