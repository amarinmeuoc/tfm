define("report_partialplan/downloadpdf",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(PDF,customerid)=>{document.querySelectorAll(".courseFinished").forEach((element=>{element.addEventListener("click",(e=>{e.preventDefault();let trainee_list=e.target.getAttribute("data-trainees").split(",");trainee_list=trainee_list.reduce(((arr,elem)=>{const aux=elem.split("_");return[...arr,{group:aux[0],billid:aux[1]}]}),[]);const coursedetail={wbs:e.target.getAttribute("data-wbs"),startdate:e.target.getAttribute("data-startdate"),enddate:e.target.getAttribute("data-enddate")};startRequestServer(PDF,customerid,coursedetail,trainee_list),window.console.log(e.target)}))}))};const startRequestServer=(PDF,customerid,coursedetail,trainee_list)=>{const xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData,token=document.querySelector("#id_token").value;formData.append("wstoken",token),formData.append("wsfunction","report_partialplan_get_assessment"),formData.append("moodlewsrestformat","json");for(let i=0;i<trainee_list.length;i++){const group=trainee_list[i].group.trim(),billid=trainee_list[i].billid.trim();formData.append("params[".concat(i,"][customerid]"),customerid),formData.append("params[".concat(i,"][group]"),group),formData.append("params[".concat(i,"][billid]"),billid),formData.append("params[".concat(i,"][wbs]"),coursedetail.wbs),formData.append("params[".concat(i,"][startdate]"),coursedetail.startdate),formData.append("params[".concat(i,"][enddate]"),coursedetail.enddate)}xhr.send(formData),xhr.onload=event=>{onLoadFunction(PDF,xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=(PDF,myXhr)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);window.console.log(res),async function(PDF,response){const pdfDoc=await PDF.PDFDocument.create(),font=await pdfDoc.embedFont(PDF.StandardFonts.Helvetica),fontBold=await pdfDoc.embedFont(PDF.StandardFonts.HelveticaBold);listTrainees=response;let page=pdfDoc.addPage();const{width:width,height:height}=page.getSize(),text="Course report",textSize=24,textWidth=font.widthOfTextAtSize(text,textSize),textHeight=font.heightAtSize(textSize),verticalGap=textHeight/2;page.drawText(text,{x:width/2-textWidth/2,y:height-textHeight-verticalGap,size:textSize,font:font,color:PDF.rgb(0,.53,.71)});const courseTitle=listTrainees[0].coursename,textCourseSize=16,textCourseTitleWidth=font.widthOfTextAtSize(courseTitle,textCourseSize),textCourseTitleHeight=font.heightAtSize(textCourseSize);page.drawText(courseTitle,{x:width/2-textCourseTitleWidth/2,y:height-textCourseTitleHeight-verticalGap-textHeight-verticalGap,size:textCourseSize,font:font,color:PDF.rgb(0,.53,.71)});let startdate=new Date(1e3*listTrainees[0].startdate),day=startdate.getDate(),month=startdate.getMonth()+1,year=startdate.getFullYear(),formattedStartDate="".concat(day.toString().padStart(2,"0"),"-").concat(month.toString().padStart(2,"0"),"-").concat(year),enddate=new Date(1e3*listTrainees[0].enddate);day=enddate.getDate(),month=enddate.getMonth()+1,year=enddate.getFullYear();let formattedEndDate="".concat(day.toString().padStart(2,"0"),"-").concat(month.toString().padStart(2,"0"),"-").concat(year);const textBody="Below is a detailed list of the grades obtained by the trainees for the course ".concat(listTrainees[0].coursename," that took place on the dates: ").concat(formattedStartDate," to ").concat(formattedEndDate,"."),textBodySize=14,textBodyHeight=(font.widthOfTextAtSize(textBody,textBodySize),font.heightAtSize(textBodySize));page.drawText(textBody,{x:40,y:height-textCourseTitleHeight-verticalGap-textHeight-verticalGap-textBodyHeight-verticalGap-verticalGap,size:textBodySize,font:font,color:PDF.rgb(0,0,0),maxWidth:width-80,wordBreaks:[" "]});let lineHeightPos=height-180;page.drawLine({start:{x:40,y:lineHeightPos},end:{x:width-40,y:lineHeightPos},thickness:1,color:PDF.rgb(0,.53,.71),opacity:.5});const field1="ID Number",textFieldSize=12,textField1Width=font.widthOfTextAtSize(field1,textFieldSize),textField1Height=font.heightAtSize(textFieldSize);page.drawText(field1,{x:55,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)});const field2="Name",textField2Width=font.widthOfTextAtSize(field2,textFieldSize);page.drawText(field2,{x:55+textField1Width+textField2Width,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)});const field3="Attendance",textField3Width=font.widthOfTextAtSize(field3,textFieldSize),field4="Assessment",textField4Width=font.widthOfTextAtSize(field4,textFieldSize);page.drawText(field3,{x:width-55-textField3Width-textField4Width-30,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(field4,{x:width-55-textField4Width,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),listTrainees.map(((trainee,index)=>{10!=index&&20!=index&&30!=index&&40!=index&&50!=index||(page=pdfDoc.addPage(),page.drawText(text,{x:width/2-textWidth/2,y:height-textHeight-verticalGap,size:textSize,font:font,color:PDF.rgb(0,.53,.71)}),page.drawText(courseTitle,{x:width/2-textCourseTitleWidth/2,y:height-textCourseTitleHeight-verticalGap-textHeight-verticalGap,size:textCourseSize,font:font,color:PDF.rgb(0,.53,.71)}),page.drawText(textBody,{x:40,y:height-textCourseTitleHeight-verticalGap-textHeight-verticalGap-textBodyHeight-verticalGap-verticalGap,size:textBodySize,font:font,color:PDF.rgb(0,0,0),maxWidth:width-80,wordBreaks:[" "]}),lineHeightPos=height-180,page.drawLine({start:{x:40,y:lineHeightPos},end:{x:width-40,y:lineHeightPos},thickness:1,color:PDF.rgb(0,.53,.71),opacity:.5}),page.drawText(field1,{x:55,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(field2,{x:55+textField1Width+textField2Width,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(field3,{x:width-55-textField3Width-textField4Width-30,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(field4,{x:width-55-textField4Width,y:height-180+textField1Height,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}));font.widthOfTextAtSize(trainee.billid,textFieldSize);let textFieldHeight=font.heightAtSize(textFieldSize);lineHeightPos-=25,page.drawText(trainee.billid,{x:55,y:lineHeightPos+textFieldHeight/2,size:textFieldSize,font:font,color:PDF.rgb(0,0,0)});font.widthOfTextAtSize(trainee.firstname+", "+trainee.lastname,textFieldSize);page.drawText(trainee.firstname+", "+trainee.lastname,{x:55+textField1Width+textField2Width,y:lineHeightPos+textFieldHeight/2,size:textFieldSize,font:font,color:PDF.rgb(0,0,0)});let attendance=null===trainee.att?"-":(1*trainee.att).toFixed(2);page.drawText(attendance,{x:width-100-textField3Width-textField4Width+textField3Width/2,y:lineHeightPos+textFieldHeight/2,size:textFieldSize,font:font,color:PDF.rgb(0,0,0)});let assessment=null===trainee.ass?"-":(1*trainee.ass).toFixed(2);page.drawText(assessment,{x:width-75-textField4Width+textField4Width/2,y:lineHeightPos+textFieldHeight/2,size:textFieldSize,font:font,color:PDF.rgb(0,0,0)}),page.drawLine({start:{x:40,y:lineHeightPos},end:{x:width-40,y:lineHeightPos},thickness:1,color:PDF.rgb(0,.53,.71),opacity:.5})}));const listComputedAtt=listTrainees.filter((elem=>null!==elem.att)),listComputedAss=listTrainees.filter((elem=>null!==elem.ass));let avgAtt=listComputedAtt.reduce(((acumulador,elementoActual)=>acumulador+Math.floor(elementoActual.att)),0)/listComputedAtt.length;avgAtt=avgAtt.toFixed(2);let avgAss=listComputedAss.reduce(((acumulador,elementoActual)=>acumulador+Math.floor(elementoActual.ass)),0)/listComputedAss.length;avgAss=avgAss.toFixed(2),page.drawText("Total course average: ",{x:width-350,y:lineHeightPos-24,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(avgAtt+" %",{x:width-100-textField3Width/2-textField4Width,y:lineHeightPos-24,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)}),page.drawText(""+avgAss,{x:width-75-textField4Width/2,y:lineHeightPos-24,size:textFieldSize,font:fontBold,color:PDF.rgb(0,0,0)});const pdfDataUri=await pdfDoc.saveAsBase64({dataUri:!0});window.open(pdfDataUri)}(PDF,res)}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))}}));

//# sourceMappingURL=downloadpdf.min.js.map