define("report_partialplan/managefilter",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=(customerid,order,orderby,orderbystartdate,orderbyenddate)=>{let bofilter=document.querySelector("#bofilter"),sdlink=document.querySelector("#sd-link"),edlink=document.querySelector("#ed-link");bofilter.addEventListener("click",(()=>{let day=document.querySelector("#id_assesstimefinish_day").value,month=document.querySelector("#id_assesstimefinish_month").value,year=document.querySelector("#id_assesstimefinish_year").value,group=document.querySelector("#selgroupid").value,billid=document.querySelector("#tebillid").value,unixtime=new Date(year,month-1,day).getTime()/1e3;requestResultFromServer(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate)})),sdlink.addEventListener("click",(e=>{e.preventDefault();let day=document.querySelector("#id_assesstimefinish_day").value,month=document.querySelector("#id_assesstimefinish_month").value,year=document.querySelector("#id_assesstimefinish_year").value,group=document.querySelector("#selgroupid").value,billid=document.querySelector("#tebillid").value,unixtime=new Date(year,month-1,day).getTime()/1e3;requestResultFromServer(customerid,group,billid,unixtime,order=!order,orderby="startdate",orderbystartdate=!0,orderbyenddate=!1)})),edlink.addEventListener("click",(e=>{e.preventDefault();let day=document.querySelector("#id_assesstimefinish_day").value,month=document.querySelector("#id_assesstimefinish_month").value,year=document.querySelector("#id_assesstimefinish_year").value,group=document.querySelector("#selgroupid").value,billid=document.querySelector("#tebillid").value,unixtime=new Date(year,month-1,day).getTime()/1e3;requestResultFromServer(customerid,group,billid,unixtime,order=!order,orderby="enddate",orderbystartdate=!0,orderbyenddate=!0)}))};const requestResultFromServer=(customerid,group,billid,unixtime,order,orderby,orderbystartdate,orderbyenddate)=>{let xhr=new XMLHttpRequest;const url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php",token=document.querySelector("#id_token").value;xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","report_partialplan_get_training_plan"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",customerid),formData.append("params[0][group]",parseInt(group)),formData.append("params[0][billid]",billid),formData.append("params[0][unixtime]",unixtime),formData.append("params[0][order]",order?1:0),formData.append("params[0][orderby]",orderby),formData.append("params[0][orderbystartdate]",orderbystartdate?1:0),formData.append("params[0][orderbyenddate]",orderbyenddate?1:0),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr,group,token)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=(myXhr,selectedGroup,token)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response),formattedData={token:token,customerid:res[0].customerid,group:res[0].group,selectedGroup:selectedGroup,courses:res[0].courses,orderbystartdate:res[0].orderbystartdate,orderbyenddate:res[0].orderbyenddate,orderby:res[0].orderby,order:res[0].order};window.console.log(formattedData),response=formattedData,_templates.default.renderForPromise("report_partialplan/content",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js);const selectGroup=document.querySelector("#selgroupid"),desiredValue=response.selectedGroup;let optionIndex=0;for(let i=0;i<selectGroup.options.length;i++)if(selectGroup.options[i].value===desiredValue){optionIndex=i;break}selectGroup.selelectedIndex=optionIndex,selectGroup.value=desiredValue})).catch((error=>(0,_notification.exception)(error)))}var response},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))}}));

//# sourceMappingURL=managefilter.min.js.map