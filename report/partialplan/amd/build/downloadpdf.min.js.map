{"version":3,"file":"downloadpdf.min.js","sources":["../src/downloadpdf.js"],"sourcesContent":["export const init=(PDF,customerid)=>{\n    let link=document.querySelectorAll('.courseFinished');\n    link.forEach(element => {\n        element.addEventListener('click',(e)=>{\n            e.preventDefault();\n            let trainee_list=e.target.getAttribute('data-trainees').split(',');\n            trainee_list=trainee_list.reduce((arr,elem)=>{\n                const aux= elem.split(\"_\");\n                return [...arr,{group:aux[0],billid:aux[1]}];\n            },[]);\n            const wbs=e.target.getAttribute('data-wbs');\n            startRequestServer(PDF,customerid,wbs,trainee_list);\n            window.console.log(e.target);\n        })\n    });\n}\n\nconst startRequestServer=(PDF,customerid,wbs,trainee_list)=>{\n    const xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n    const formData= new FormData();\n    const token=document.querySelector('#id_token').value;\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_partialplan_get_assessment');\n    formData.append('moodlewsrestformat','json');\n    for (let i=0;i<trainee_list.length;i++){\n        const group=trainee_list[i].group.trim();\n        const billid=trainee_list[i].billid.trim();\n        formData.append(`params[${i}][customerid]`,customerid);\n        formData.append(`params[${i}][group]`,group);\n        formData.append(`params[${i}][billid]`,billid);\n        formData.append(`params[${i}][wbs]`,wbs);\n    }            \n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(PDF,xhr);\n        };\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onLoadFunction=(PDF,myXhr)=>{\n    if (myXhr.readyState=== 4 && myXhr. status === 200){\n      const res=JSON.parse(myXhr.response);\n      window.console.log(res);\n      //Prepare the excel for to be downloaded\n      createPdf(PDF,res);\n  }\n  }\n\nconst onProgressFunction= (event)=>{\n    if (event.lengthComputable) {\n      window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n    } else {\n      window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n    }\n}\n\nasync function createPdf(PDF,response){\n    const pdfDoc = await PDF.PDFDocument.create();\n        const helvetica = await pdfDoc.embedFont(PDF.StandardFonts.Helvetica);\n          const helveticaBold = await pdfDoc.embedFont(PDF.StandardFonts.HelveticaBold);\n        const pdfDataUri=await pdfDoc.saveAsBase64({dataUri:true});\n        window.open(pdfDataUri);\n};\n"],"names":["PDF","customerid","document","querySelectorAll","forEach","element","addEventListener","e","preventDefault","trainee_list","target","getAttribute","split","reduce","arr","elem","aux","group","billid","wbs","startRequestServer","window","console","log","xhr","XMLHttpRequest","url","location","protocol","hostname","open","formData","FormData","token","querySelector","value","append","i","length","trim","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","myXhr","readyState","status","res","JSON","parse","response","pdfDoc","PDFDocument","create","pdfDataUri","embedFont","StandardFonts","Helvetica","HelveticaBold","saveAsBase64","dataUri","createPdf","lengthComputable","loaded","total"],"mappings":"mKAAkB,CAACA,IAAIC,cACVC,SAASC,iBAAiB,mBAC9BC,SAAQC,UACTA,QAAQC,iBAAiB,SAASC,IAC9BA,EAAEC,qBACEC,aAAaF,EAAEG,OAAOC,aAAa,iBAAiBC,MAAM,KAC9DH,aAAaA,aAAaI,QAAO,CAACC,IAAIC,cAC5BC,IAAKD,KAAKH,MAAM,WACf,IAAIE,IAAI,CAACG,MAAMD,IAAI,GAAGE,OAAOF,IAAI,OAC1C,UACIG,IAAIZ,EAAEG,OAAOC,aAAa,YAChCS,mBAAmBpB,IAAIC,WAAWkB,IAAIV,cACtCY,OAAOC,QAAQC,IAAIhB,EAAEG,qBAK3BU,mBAAmB,CAACpB,IAAIC,WAAWkB,IAAIV,sBACnCe,IAAI,IAAIC,eACRC,IAAIL,OAAOM,SAASC,SAAS,KAAKP,OAAOM,SAASE,SAAS,8BACjEL,IAAIM,KAAK,OAAOJ,KAAI,SACdK,SAAU,IAAIC,SACdC,MAAM/B,SAASgC,cAAc,aAAaC,MAChDJ,SAASK,OAAO,UAAUH,OAC1BF,SAASK,OAAO,aAAa,qCAC7BL,SAASK,OAAO,qBAAqB,YAChC,IAAIC,EAAE,EAAEA,EAAE5B,aAAa6B,OAAOD,IAAI,OAC7BpB,MAAMR,aAAa4B,GAAGpB,MAAMsB,OAC5BrB,OAAOT,aAAa4B,GAAGnB,OAAOqB,OACpCR,SAASK,wBAAiBC,mBAAiBpC,YAC3C8B,SAASK,wBAAiBC,cAAYpB,OACtCc,SAASK,wBAAiBC,eAAanB,QACvCa,SAASK,wBAAiBC,YAAUlB,KAExCK,IAAIgB,KAAKT,UACTP,IAAIiB,OAAUC,QACVC,eAAe3C,IAAIwB,MAEvBA,IAAIoB,WAAcF,QACdG,mBAAmBH,QAEvBlB,IAAIsB,QAAU,WACVzB,OAAOC,QAAQC,IAAI,uBAIrBoB,eAAe,CAAC3C,IAAI+C,YACE,IAApBA,MAAMC,YAAqC,MAAlBD,MAAOE,OAAe,OAC3CC,IAAIC,KAAKC,MAAML,MAAMM,UAC3BhC,OAAOC,QAAQC,IAAI2B,oBAcAlD,IAAIqD,gBACnBC,aAAetD,IAAIuD,YAAYC,SAG3BC,kBAFkBH,OAAOI,UAAU1D,IAAI2D,cAAcC,iBAC7BN,OAAOI,UAAU1D,IAAI2D,cAAcE,qBAC1CP,OAAOQ,aAAa,CAACC,SAAQ,KACpD1C,OAAOS,KAAK2B,YAjBdO,CAAUhE,OAIV6C,mBAAqBH,QACnBA,MAAMuB,iBACR5C,OAAOC,QAAQC,wBAAiBmB,MAAMwB,sBAAaxB,MAAMyB,iBAEzD9C,OAAOC,QAAQC,wBAAiBmB,MAAMwB"}