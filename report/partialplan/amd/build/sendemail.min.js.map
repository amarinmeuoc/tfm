{"version":3,"file":"sendemail.min.js","sources":["../src/sendemail.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport {get_string as getString} from 'core/str';\n\nexport const init = (customerid) => {\n    let trainee_list=document.querySelectorAll('.boemail');\n    trainee_list.forEach((node)=>{\n        node.addEventListener('click',(e)=>{\n            traineesFunctionEvent(e,customerid);\n        });\n    })\n}\n\nconst addNotification = msg => {\n    addToast(msg);\n};\n\nconst traineesFunctionEvent=(e,customerid)=>{\n    e.stopPropagation(); //To avoid the event bubbles up further up the DOM tree, stopping it at the button element\n    const element=e.target.closest('button');\n    const modalForm= new ModalForm({\n        formClass: \"\\\\report_partialplan\\\\form\\\\Modal_Form\",\n        args: {list_trainees: element.getAttribute('data-id'),customer:customerid},\n        modalConfig: {title: \"Send email to...\"},\n        returnFocus: element\n    });\n    \n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e)=>{\n        const xhr=new XMLHttpRequest();\n        const url='./send_email.php';\n        xhr.open('POST',url,true);\n        const formData= new FormData();\n        \n        formData.append('messagebody',e.detail.teeditor.text);\n        formData.append('to',e.detail.emailhidden);\n        formData.append('subject',e.detail.tesubject);\n       \n        xhr.send(formData);\n        xhr.onload = (event) =>{\n            onLoadFunction(xhr);\n        };\n        xhr.onprogress = (event)=>{\n            onProgressFunction(event);\n        } \n        xhr.onerror = function() {\n            addNotification('Something went wrong. Please contact with the admin');\n        };\n    });\n\n    const onProgressFunction=(event)=> {\n        if (event.lengthComputable) {\n          window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n        } else {\n          window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n        }\n      };\n      \n      const onLoadFunction=(myxhr)=>{\n        if (myxhr.readyState=== 4 && myxhr.status === 200){\n          const res=JSON.parse(myxhr.response);\n            if (res.result)\n                addNotification('The email has been sent successfully');\n            else \n                addNotification('Something went wrong. Please contact with the admin');\n        }\n      }\n    \n    modalForm.addEventListener(modalForm.events.LOADED, (e)=>{\n        //Changing the text of the dynamic button\n        e.target.querySelector(\"button[data-action='save']\").textContent=\"Send Email\"\n        \n        }\n    );\n    \n    modalForm.show();\n}"],"names":["customerid","document","querySelectorAll","forEach","node","addEventListener","e","traineesFunctionEvent","addNotification","msg","stopPropagation","element","target","closest","modalForm","ModalForm","formClass","args","list_trainees","getAttribute","customer","modalConfig","title","returnFocus","events","FORM_SUBMITTED","xhr","XMLHttpRequest","open","formData","FormData","append","detail","teeditor","text","emailhidden","tesubject","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","lengthComputable","window","console","log","loaded","total","myxhr","readyState","status","JSON","parse","response","result","LOADED","querySelector","textContent","show"],"mappings":"4bAKqBA,aACAC,SAASC,iBAAiB,YAC9BC,SAASC,OAClBA,KAAKC,iBAAiB,SAASC,IAC3BC,sBAAsBD,EAAEN,yBAK9BQ,gBAAkBC,qBACXA,MAGPF,sBAAsB,CAACD,EAAEN,cAC3BM,EAAEI,wBACIC,QAAQL,EAAEM,OAAOC,QAAQ,UACzBC,UAAW,IAAIC,mBAAU,CAC3BC,UAAW,yCACXC,KAAM,CAACC,cAAeP,QAAQQ,aAAa,WAAWC,SAASpB,YAC/DqB,YAAa,CAACC,MAAO,oBACrBC,YAAaZ,UAGjBG,UAAUT,iBAAiBS,UAAUU,OAAOC,gBAAiBnB,UACnDoB,IAAI,IAAIC,eAEdD,IAAIE,KAAK,OADC,oBACU,SACdC,SAAU,IAAIC,SAEpBD,SAASE,OAAO,cAAczB,EAAE0B,OAAOC,SAASC,MAChDL,SAASE,OAAO,KAAKzB,EAAE0B,OAAOG,aAC9BN,SAASE,OAAO,UAAUzB,EAAE0B,OAAOI,WAEnCV,IAAIW,KAAKR,UACTH,IAAIY,OAAUC,QACVC,eAAed,MAEnBA,IAAIe,WAAcF,QACdG,mBAAmBH,QAEvBb,IAAIiB,QAAU,WACVnC,gBAAgB,iEAIlBkC,mBAAoBH,QAClBA,MAAMK,iBACRC,OAAOC,QAAQC,wBAAiBR,MAAMS,sBAAaT,MAAMU,iBAEzDJ,OAAOC,QAAQC,wBAAiBR,MAAMS,mBAIpCR,eAAgBU,WACI,IAApBA,MAAMC,YAAoC,MAAjBD,MAAME,OAAe,CACtCC,KAAKC,MAAMJ,MAAMK,UACjBC,OACJhD,gBAAgB,wCAEhBA,gBAAgB,yDAI5BM,UAAUT,iBAAiBS,UAAUU,OAAOiC,QAASnD,IAEjDA,EAAEM,OAAO8C,cAAc,8BAA8BC,YAAY,gBAKrE7C,UAAU8C"}