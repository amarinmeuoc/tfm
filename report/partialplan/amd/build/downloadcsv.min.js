define("report_partialplan/downloadcsv",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=customerid=>{document.querySelectorAll(".bodownload").forEach((node=>{node.addEventListener("click",(e=>{downloadcsv(e,customerid)}))}))};const downloadcsv=(e,customerid)=>{e.preventDefault();let list_of_trainees=e.target.closest("a").getAttribute("data-id");list_of_trainees=list_of_trainees.split(","),list_of_trainees=list_of_trainees.reduce(((arr,elem)=>{const aux=elem.split("_");return[...arr,{group:aux[0],billid:aux[1]}]}),[]);const xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData,token=document.querySelector("#id_token").value;formData.append("wstoken",token),formData.append("wsfunction","report_partialplan_get_trainees"),formData.append("moodlewsrestformat","json");for(let i=0;i<list_of_trainees.length;i++){const group=list_of_trainees[i].group.trim(),billid=list_of_trainees[i].billid.trim();formData.append("params[".concat(i,"][customerid]"),parseInt(customerid)),formData.append("params[".concat(i,"][group]"),group),formData.append("params[".concat(i,"][billid]"),billid)}xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=myXhr=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);createExcelFromJSON(res)}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))},createExcelFromJSON=res=>{if(res.length>0){const titles=Object.keys(res[0]);(res=res.map((elem=>Object.values(elem)))).unshift(titles)}let csvContent="";res.forEach((row=>{csvContent+=row.join(";")+"\n"}));const blob=new Blob(["\ufeff"+csvContent],{type:"text/csv;charset=utf-16;"}),objUrl=URL.createObjectURL(blob),dr=new Date,nameFile="Trainee_list_loader_"+dr.getDate()+"."+(dr.getMonth()+1)+"."+dr.getFullYear()+".csv",link=document.createElement("a");link.setAttribute("href",objUrl),link.setAttribute("download",nameFile),link.click()}}));

//# sourceMappingURL=downloadcsv.min.js.map