define("report_partialplan/downloadcsv",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=customerid=>{document.querySelectorAll(".bodownload").forEach((node=>{node.addEventListener("click",(e=>{downloadcsv(e,customerid)}))})),window.console.log("show trainees... ")};const downloadcsv=(e,customerid)=>{e.stopPropagation();const element=e.target.closest("a");let list_of_trainees=element.getAttribute("data-id");list_of_trainees=list_of_trainees.split(","),list_of_trainees=list_of_trainees.reduce(((arr,elem)=>{const aux=elem.split("_");return[...arr,{group:aux[0],billid:aux[1]}]}),[]);const xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const token=document.querySelector("#id_token").value,formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","report_partialplan_get_trainees"),formData.append("moodlewsrestformat","json");for(let i=0;i<list_of_trainees.length;i++){const group=list_of_trainees[i].group.trim(),billid=list_of_trainees[i].billid.trim();formData.append("params[".concat(i,"][customerid]"),parseInt(customerid)),formData.append("params[".concat(i,"][group]"),group),formData.append("params[".concat(i,"][billid]"),billid)}xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr,element)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=(myXhr,element)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response),titleKeys=Object.keys(res[0]),refinedData=[];refinedData.push(titleKeys),res.forEach((item=>{refinedData.push(Object.values(item))}));let csvContent="";refinedData.forEach((row=>{csvContent+=row.join(";")+"\n"}));const blob=new Blob([csvContent],{type:"text/csv;charset=utf-8,"}),objURL=URL.createObjectURL(blob);element.setAttribute("href",objURL),element.setAttribute("download","file.csv")}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))}}));

//# sourceMappingURL=downloadcsv.min.js.map