{"version":3,"file":"exportExcel.min.js","sources":["../src/exportExcel.js"],"sourcesContent":["\nexport const init=(XLSX, filesaver,blobutil,token)=>{\n    const boexport=document.querySelector('#idexport');\n    boexport.addEventListener('click',(e)=>{\n        exportToExcel(e,XLSX,filesaver,blobutil,token);\n    });\n}\n\nconst exportToExcel=(e,XLSX,filesaver,blobutil,token)=>{\n    const data={\n        orderby:'DateAtt',\n        customerid:document.querySelector('#customerid').value,\n        groupid:document.querySelector('#selgroupid').value,\n        billid:document.querySelector('#billid').value,\n        attP:(document.querySelector('#chkPresent').checked)?true:false,\n        attA:(document.querySelector('#chkAbsent').checked)?true:false,\n        attL:(document.querySelector('#chkLate').checked)?true:false,\n        attE:(document.querySelector('#chkExcused').checked)?true:false,\n        startdate:document.querySelector('#startdate').value,\n        enddate:document.querySelector('#enddate').value,\n        token:token\n    }\n    prepareDataToSend(data);\n}\n\nconst prepareDataToSend=(data)=>{\n    const xhr=new XMLHttpRequest();\n    const url='http://'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n \n    const formData= new FormData();\n    formData.append('wstoken',data.token);\n    formData.append('wsfunction','report_dailyattendance_get_list_courses');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customerid]',data.customerid);\n    formData.append('params[0][order]','ASC');\n    formData.append('params[0][orderby]',data.orderby);\n    formData.append('params[0][groupid]',data.groupid);\n    formData.append('params[0][billid]',data.billid);\n    formData.append('params[0][page]',0);\n    formData.append('params[0][offset]',100);\n    formData.append('params[0][startdate]',Math.floor(new Date(data.startdate).getTime() / 1000));\n    formData.append('params[0][enddate]',Math.floor(new Date(data.enddate).getTime() / 1000));\n    formData.append('params[0][attendanceStatus][statusPresent]',data.attP);\n    formData.append('params[0][attendanceStatus][statusAbsent]',data.attA);\n    formData.append('params[0][attendanceStatus][statusLate]',data.attL);\n    formData.append('params[0][attendanceStatus][statusExcused]',data.attE);\n\n    xhr.send(formData);\n    xhr.onload=(event)=>{\n        onLoadFunction(xhr);\n    }\n\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n\n}\n\nconst onLoadFunction=(myXhr)=>{\n    const loader=document.querySelector('.loader');\n    loader.classList.add('.hide');\n    loader.classList.remove('.show');\n\n    if (myXhr.readyState===4 && myXhr.status===200){\n        const res=JSON.parse(myXhr.response);\n        createExcelFromJSON(res,'dailyattendance');\n        \n    }\n}\n\nconst onProgressFunction=(event) =>{\n    console.log(`Uploaded ${event.loaded} of ${event.total}`);\n    const loader=document.querySelector('.loader');\n    loader.classList.remove('.hide');\n    loader.classList.add('.show');\n}\n\nconst createExcelFromJSON=(res,op)=>{\n    let listado=[];\n    if (res[0].attendance_list.length>0){\n        listado=res[0].attendance_list.map(elem=>{\n            const date=new Date(elem.dateatt*1000);\n            const year=date.getFullYear();\n            const month=date.getMonth()+1;\n            const day=date.getDate()+1;\n            elem.dateatt=new Date(year+\"-\"+month+\"-\"+day);\n            return Object.values(elem);\n        });\n        let titles=Object.keys(res[0].attendance_list[0]);\n        listado.unshift(titles);\n    }\n    \n    const wb=XLSX.utils.book_new();\n    const dr=new Date();\n    const dateFile=dr.getDate();\n    const month=dr.getMonth()+1\n    const year=dr.getFullYear();\n    const min=dr.getMinutes();\n    const hour=dr.getHours();\n    \n    wb.Props={\n        Title: \"Daily attendance report\",\n        Subject: \"Training program report\",\n        Author: \"Alberto MarÃ­n\",\n        CreateDate: new Date(year,month,dateFile)\n    };\n    wb.SheetNames.push(\"daily attendance\");\n    \n    const ws=XLSX.utils.aoa_to_sheet(listado);\n    wb.Sheets[\"daily attendance\"]=ws;\n    const wbout=XLSX.write(wb,{bookType:'xlsx',type:'binary'});\n    const nameFile='dailyReport_'+dateFile+'.'+month+'.'+year+'.'+hour+'.'+min+'.xlsx';\n    saveAs(new Blob([s2ab(wbout)],{type:\"application/octet-stream\"}),nameFile)\n    \n}\n\nconst s2ab=(s) => {\n    var buf = new ArrayBuffer(s.length);\n    var view = new Uint8Array(buf);\n    for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;\n    return buf;\n}"],"names":["XLSX","filesaver","blobutil","token","document","querySelector","addEventListener","e","exportToExcel","data","orderby","customerid","value","groupid","billid","attP","checked","attA","attL","attE","startdate","enddate","prepareDataToSend","xhr","XMLHttpRequest","url","window","location","hostname","open","formData","FormData","append","Math","floor","Date","getTime","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","console","log","myXhr","loader","classList","add","remove","readyState","status","res","JSON","parse","response","createExcelFromJSON","loaded","total","op","listado","attendance_list","length","map","elem","date","dateatt","year","getFullYear","month","getMonth","day","getDate","Object","values","titles","keys","unshift","wb","utils","book_new","dr","dateFile","min","getMinutes","hour","getHours","Props","Title","Subject","Author","CreateDate","SheetNames","push","ws","aoa_to_sheet","Sheets","wbout","write","bookType","type","nameFile","saveAs","Blob","s2ab","s","buf","ArrayBuffer","view","Uint8Array","i","charCodeAt"],"mappings":"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"}