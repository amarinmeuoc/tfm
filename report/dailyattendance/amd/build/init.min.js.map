{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const init = (order,orderby,page, offset, showCustomerSelect,token) => {\n    const valuesObj={\n        order:order,\n        orderby:orderby,\n        page:page,\n        offset:offset,\n        showCustomerSelect:showCustomerSelect,\n        token:token,\n        pages:document.querySelectorAll('.pagination>li a'),\n        customerid:document.querySelector('#customerid'),\n        startdate:document.querySelector('#startdate'),\n        enddate:document.querySelector('#enddate'),\n        group:document.querySelector('#selgroupid'),\n        billid:document.querySelector('#billid'),\n        attP:document.querySelector('#chkPresent'),\n        attA:document.querySelector('#chkAbsent'),\n        attL:document.querySelector('#chkLate'),\n        attE:document.querySelector('#chkExcused'),\n        ordenablefield:document.querySelectorAll('.orderby'),\n        button:document.querySelector('#idfilter')\n    }\n\n    //Depending of in which column the user clicks, the orderby needs to be setup with the right name.\n    valuesObj.ordenablefield.forEach((element) => {\n        element.addEventListener('click',(e)=>{\n            if (valuesObj.orderby===e.target.dataset.value)\n                valuesObj.order=(valuesObj.order==='ASC')?'DESC':'ASC';\n            valuesObj.orderby=e.target.dataset.value;\n            //valuesObj.page=parseInt(document.querySelector('.pagination .active').textContent);\n            valuesObj.page=1;\n            processRequest(valuesObj);\n        })\n    },valuesObj);\n\n    //Controlling the pagination\n    valuesObj.pages.forEach(elem=>{\n        elem.addEventListener('click',(e)=>{       \n            e.preventDefault();\n            //page=e.target.closest('li').dataset.value-1;\n            processRequest(valuesObj);\n        })\n    },valuesObj);\n\n    //Filtering...\n    valuesObj.button.addEventListener('click',(e)=>{\n        valuesObj.page=1; //Starting from page 1\n        processRequest(valuesObj);\n    },valuesObj)\n\n    if (valuesObj.showCustomerSelect){\n        customerid.addEventListener('change',(e)=>{\n            updateGroupList(e,valuesObj);\n        });\n    }\n};\n\nconst updateGroupList=(e,values)=>{\n    const cid=e.target.value;\n    requestGroupList(cid,values);\n}\n\nconst requestGroupList=(cid,values)=>{\n    let xhr=new XMLHttpRequest();\n    const url='http://'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n \n    const formData= new FormData();\n    formData.append('wstoken',values.token);\n    formData.append('wsfunction','report_dailyattendance_get_list_group');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customerid]',cid);\n\n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadGroupListFunction(xhr, cid);\n    };\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onLoadGroupListFunction=(myXhr,cid)=>{\n    if (myXhr.readyState===4 && myXhr.status===200){\n        const res=JSON.parse(myXhr.response);\n        \n        //Getting the JSON Object so rebuilding the group Selector\n        window.console.log(res);\n        const selGroup=document.querySelector('#selgroupid');\n        selGroup.innerHTML=\"\";\n        res.forEach(group=>{\n            selGroup.innerHTML+=`<option value=${group.id}>${group.name}</option>`\n        })\n\n        \n    }\n}\n\nconst processRequest=(valuesObj)=>{\n    const sdv=Math.floor(new Date(valuesObj.startdate.value).getTime() / 1000);\n    const edv=Math.floor(new Date(valuesObj.enddate.value).getTime() / 1000);\n    const cv=valuesObj.customerid.value;\n    const vv=parseInt(valuesObj.group.value);\n    const bv=valuesObj.billid.value;\n    const attStatus={\n        attPv:(valuesObj.attP.checked)?true:false,\n        attAv:(valuesObj.attA.checked)?true:false,\n        attLv:(valuesObj.attL.checked)?true:false,\n        attEv:(valuesObj.attE.checked)?true:false,\n    };\n    const ofv=valuesObj.offset;\n    const adaptedObj={\n        orderby:valuesObj.orderby,\n        order:valuesObj.order,\n        page:valuesObj.page,\n        attStatus:attStatus,\n        ofv:ofv,\n        sdv:sdv,\n        edv:edv,\n        cv:cv,\n        vv:vv,\n        bv:bv,\n        showCustomerSelect:valuesObj.showCustomerSelect,\n        token:valuesObj.token\n    }\n    \n    processRequestStart(adaptedObj);\n\n    \n}\n\nconst processRequestStart=(adaptedObj)=>{\n    let xhr=new XMLHttpRequest();\n    const url='http://'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n \n    const formData= new FormData();\n    formData.append('wstoken',adaptedObj.token);\n    formData.append('wsfunction','report_dailyattendance_get_list_courses');\n    formData.append('moodlewsrestformat','json');\n    \n    formData.append('params[0][orderby]',adaptedObj.orderby);\n    formData.append('params[0][order]',adaptedObj.order);\n    formData.append('params[0][page]',adaptedObj.page);\n    formData.append('params[0][startdate]',adaptedObj.sdv);\n    formData.append('params[0][enddate]',adaptedObj.edv);\n    formData.append('params[0][groupid]',adaptedObj.vv);\n    formData.append('params[0][billid]',adaptedObj.bv);\n    formData.append('params[0][attendanceStatus][statusPresent]',adaptedObj.attStatus.attPv);\n    formData.append('params[0][attendanceStatus][statusAbsent]',adaptedObj.attStatus.attAv);\n    formData.append('params[0][attendanceStatus][statusLate]',adaptedObj.attStatus.attLv);\n    formData.append('params[0][attendanceStatus][statusExcused]',adaptedObj.attStatus.attEv);\n    formData.append('params[0][offset]',adaptedObj.ofv);\n    formData.append('params[0][customerid]',adaptedObj.cv);\n    window.console.log(adaptedObj);\n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr, adaptedObj.orderby, adaptedObj.order, adaptedObj.page, adaptedObj.ofv, adaptedObj.showCustomerSelect, adaptedObj.cv,adaptedObj.token);\n    };\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onLoadFunction=(myXhr, orderby, order, page, ofv, showCustomerSelect, customerid,token)=>{\n    const loader=document.querySelector('.loader');\n    loader.classList.add('.hide');\n    loader.classList.remove('.show');\n\n    if (myXhr.readyState===4 && myXhr.status===200){\n        const res=JSON.parse(myXhr.response);\n        window.console.log(\"la pagina seleccionada es: \",page);\n        const formattedData={\n            showCustomerSelect:showCustomerSelect,\n            customerid:customerid,\n            attendance_list:res[0].attendance_list,\n            num_records:res[0].attendance_list.length,\n            num_total_records:res[0].num_total_records,\n            order:(res[0].order==='ASC')?true:false,\n            orderby:orderby,\n            selected_page:page,\n            offset:ofv,\n            pages:res[0].pages,\n            orderbydate:res[0].orderbydate,\n            orderbybillid:res[0].orderbybillid,\n            orderbygroup:res[0].orderbygroup,\n            orderbyname:res[0].orderbyname,\n            orderbylastname:res[0].orderbylastname,\n            orderbydescription:res[0].orderbydescription,\n            orderbywbs:res[0].orderbywbs,\n            token:token\n        }\n        showTemplateAttendance(formattedData);\n        window.console.log(res);\n    }\n}\n\nconst onProgressFunction=(event) =>{\n    console.log(`Uploaded ${event.loaded} of ${event.total}`);\n    const loader=document.querySelector('.loader');\n    loader.classList.remove('.hide');\n    loader.classList.add('.show');\n}\n\nfunction showTemplateAttendance(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_dailyattendance/content-ajax',response)\n    .then(({html,js})=>{\n        \n        const content=document.querySelector('#content');\n        content.innerHTML='';\n        Templates.appendNodeContents(content,html,js);\n            const pages=document.querySelectorAll('.pagination>li a');\n            const customerid=document.querySelector('#customerid');\n            const sd=document.querySelector('#startdate');\n            const ed=document.querySelector('#enddate');\n            const group=document.querySelector('#selgroupid');\n            const billid=document.querySelector('#billid');\n            const attP=document.querySelector('#chkPresent');\n            const attA=document.querySelector('#chkAbsent');\n            const attL=document.querySelector('#chkLate');\n            const attE=document.querySelector('#chkExcused');\n            const ordenablefield=document.querySelectorAll('.orderby');\n            const order=(response.order)?'ASC':'DESC';\n            const showCustomerSelect=response.showCustomerSelect;\n            const offset=response.offset;\n            const orderby=response.orderby;\n            const page=response.selected_page;\n            const token=response.token;\n\n            const valuesObj={\n                order:order,\n                orderby:orderby,\n                page:page,\n                offset:offset,\n                showCustomerSelect:showCustomerSelect,\n                token:token,\n                pages:pages,\n                customerid:customerid,\n                startdate:sd,\n                enddate:ed,\n                group:group,\n                billid:billid,\n                attP:attP,\n                attA:attA,\n                attL:attL,\n                attE:attE,\n                ordenablefield:ordenablefield\n            }\n            \n           \n\n            //Depending of in which column the user clicks, the orderby needs to be setup with the right name.\n            ordenablefield.forEach((element) => {\n                element.addEventListener('click',(e)=>{\n                    e.preventDefault();\n                    //const page=parseInt(document.querySelector('.pagination .active').textContent);\n                    const page=1;\n                    window.console.log(\"Pagina seleccionada al ordenar es: \",page);\n                    if (valuesObj.orderby===e.target.dataset.value)\n                        valuesObj.order=(valuesObj.order==='ASC')?'DESC':'ASC';\n                    const orderby=e.target.dataset.value;\n                    valuesObj.orderby=orderby;\n                    valuesObj.page=page;\n                    processRequest(valuesObj);\n                })\n            },valuesObj);\n            //Controlling the pagination\n            pages.forEach((elem)=>{\n\n                elem.addEventListener('click',(e)=>{\n                    const pages=document.querySelectorAll('.pagination>li');\n                    pages.forEach(elem=>{\n                        elem.classList.remove('active');\n                    });\n                    \n                    e.preventDefault();\n                    pageval=parseInt(e.target.text);\n                    window.console.log(\"Pagina seleccionada al paginar es: \",page);\n                    valuesObj.page=pageval;\n                    processRequest(valuesObj);\n                })\n                \n            },valuesObj);\n\n    })\n    .catch((error)=>displayException(error));\n  }"],"names":["order","orderby","page","offset","showCustomerSelect","token","valuesObj","pages","document","querySelectorAll","customerid","querySelector","startdate","enddate","group","billid","attP","attA","attL","attE","ordenablefield","button","forEach","element","addEventListener","e","target","dataset","value","processRequest","elem","preventDefault","updateGroupList","values","cid","requestGroupList","xhr","XMLHttpRequest","url","window","location","hostname","open","formData","FormData","append","send","onload","event","onLoadGroupListFunction","onprogress","onProgressFunction","onerror","console","log","myXhr","readyState","status","res","JSON","parse","response","selGroup","innerHTML","id","name","sdv","Math","floor","Date","getTime","edv","cv","vv","parseInt","bv","attStatus","attPv","checked","attAv","attLv","attEv","ofv","adaptedObj","processRequestStart","onLoadFunction","loader","classList","add","remove","formattedData","attendance_list","num_records","length","num_total_records","selected_page","orderbydate","orderbybillid","orderbygroup","orderbyname","orderbylastname","orderbydescription","orderbywbs","renderForPromise","then","_ref","html","js","content","appendNodeContents","sd","ed","pageval","text","catch","error","loaded","total"],"mappings":"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"}