define("report_dailyattendance/exportExcel",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(XLSX,filesaver,blobutil,token)=>{document.querySelector("#idexport").addEventListener("click",(e=>{const loader=document.querySelector(".loader");loader.classList.remove("hide"),loader.classList.add("show"),exportToExcel(e,XLSX,filesaver,blobutil,token)}))};const exportToExcel=(e,XLSX,filesaver,blobutil,token)=>{const data={orderby:"DateAtt",customerid:document.querySelector("#customerid").value,groupid:document.querySelector("#selgroupid").value,billid:document.querySelector("#billid").value,attP:!!document.querySelector("#chkPresent").checked,attA:!!document.querySelector("#chkAbsent").checked,attL:!!document.querySelector("#chkLate").checked,attE:!!document.querySelector("#chkExcused").checked,startdate:document.querySelector("#startdate").value,enddate:document.querySelector("#enddate").value,token:token};prepareDataToSend(data)},prepareDataToSend=data=>{const xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",data.token),formData.append("wsfunction","report_dailyattendance_get_list_courses"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",data.customerid),formData.append("params[0][order]","ASC"),formData.append("params[0][orderby]",data.orderby),formData.append("params[0][groupid]",data.groupid),formData.append("params[0][billid]",data.billid),formData.append("params[0][page]",0),formData.append("params[0][offset]",100),formData.append("params[0][startdate]",Math.floor(new Date(data.startdate).getTime()/1e3)),formData.append("params[0][enddate]",Math.floor(new Date(data.enddate).getTime()/1e3)),formData.append("params[0][attendanceStatus][statusPresent]",data.attP),formData.append("params[0][attendanceStatus][statusAbsent]",data.attA),formData.append("params[0][attendanceStatus][statusLate]",data.attL),formData.append("params[0][attendanceStatus][statusExcused]",data.attE),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onloadend=event=>{const loader=document.querySelector(".loader");loader.classList.remove("show"),loader.classList.add("hide")},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=myXhr=>{const loader=document.querySelector(".loader");if(loader.classList.add(".hide"),loader.classList.remove(".show"),4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);createExcelFromJSON(res,"dailyattendance")}},onProgressFunction=event=>{console.log("Uploaded ".concat(event.loaded," of ").concat(event.total));const loader=document.querySelector(".loader");loader.classList.remove(".hide"),loader.classList.add(".show")},createExcelFromJSON=(res,op)=>{let listado=[];if(res[0].attendance_list.length>0){listado=res[0].attendance_list.map((elem=>{const date=new Date(1e3*elem.dateatt),year=date.getFullYear(),month=date.getMonth(),day=date.getDate();return elem.dateatt=new Date(year,month,day),elem.dateatt.setDate(elem.dateatt.getDate()+1),Object.values(elem)}));let titles=Object.keys(res[0].attendance_list[0]);listado.unshift(titles)}const wb=XLSX.utils.book_new(),dr=new Date,dateFile=dr.getDate(),month=dr.getMonth()+1,year=dr.getFullYear(),min=dr.getMinutes(),hour=dr.getHours();wb.Props={Title:"Daily attendance report",Subject:"Training program report",Author:"Alberto MarÃ­n",CreateDate:new Date(year,month,dateFile)},wb.SheetNames.push("daily attendance");const ws=XLSX.utils.aoa_to_sheet(listado);wb.Sheets["daily attendance"]=ws;const wbout=XLSX.write(wb,{bookType:"xlsx",type:"binary"}),nameFile="dailyReport_"+dateFile+"."+month+"."+year+"."+hour+"."+min+".xlsx";saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}),nameFile)},s2ab=s=>{for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}}));

//# sourceMappingURL=exportExcel.min.js.map