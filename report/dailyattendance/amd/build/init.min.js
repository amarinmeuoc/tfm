define("report_dailyattendance/init",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=(order,orderby,page,offset,showCustomerSelect,token)=>{const valuesObj={order:order,orderby:orderby,page:page,offset:offset,showCustomerSelect:showCustomerSelect,token:token,pages:document.querySelectorAll(".pagination>li a"),customerid:document.querySelector("#customerid"),startdate:document.querySelector("#startdate"),enddate:document.querySelector("#enddate"),group:document.querySelector("#selgroupid"),billid:document.querySelector("#billid"),attP:document.querySelector("#chkPresent"),attA:document.querySelector("#chkAbsent"),attL:document.querySelector("#chkLate"),attE:document.querySelector("#chkExcused"),ordenablefield:document.querySelectorAll(".orderby"),button:document.querySelector("#idfilter")};valuesObj.ordenablefield.forEach((element=>{element.addEventListener("click",(e=>{valuesObj.orderby===e.target.dataset.value&&(valuesObj.order="ASC"===valuesObj.order?"DESC":"ASC"),valuesObj.orderby=e.target.dataset.value,valuesObj.page=1,processRequest(valuesObj)}))}),valuesObj),valuesObj.pages.forEach((elem=>{elem.addEventListener("click",(e=>{e.preventDefault(),processRequest(valuesObj)}))}),valuesObj),valuesObj.button.addEventListener("click",(e=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("hide"),loader.classList.add("show"),table.classList.add("hide"),valuesObj.page=1,processRequest(valuesObj)}),valuesObj),valuesObj.showCustomerSelect&&customerid.addEventListener("change",(e=>{updateGroupList(e,valuesObj)}))};const updateGroupList=(e,values)=>{const cid=e.target.value;requestGroupList(cid,values)},requestGroupList=(cid,values)=>{let xhr=new XMLHttpRequest;const url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",values.token),formData.append("wsfunction","report_dailyattendance_get_list_group"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",cid),xhr.send(formData),xhr.onload=event=>{onLoadGroupListFunction(xhr,cid)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadGroupListFunction=(myXhr,cid)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response),selGroup=document.querySelector("#selgroupid");selGroup.innerHTML="",res.forEach((group=>{selGroup.innerHTML+="<option value=".concat(group.id,">").concat(group.name,"</option>")}))}},processRequest=valuesObj=>{const sdv=Math.floor(new Date(valuesObj.startdate.value).getTime()/1e3),edv=Math.floor(new Date(valuesObj.enddate.value).getTime()/1e3),cv=valuesObj.customerid.value,vv=parseInt(valuesObj.group.value),bv=valuesObj.billid.value,attStatus={attPv:!!valuesObj.attP.checked,attAv:!!valuesObj.attA.checked,attLv:!!valuesObj.attL.checked,attEv:!!valuesObj.attE.checked},ofv=valuesObj.offset,adaptedObj={orderby:valuesObj.orderby,order:valuesObj.order,page:valuesObj.page,attStatus:attStatus,ofv:ofv,sdv:sdv,edv:edv,cv:cv,vv:vv,bv:bv,showCustomerSelect:valuesObj.showCustomerSelect,token:valuesObj.token};processRequestStart(adaptedObj)},processRequestStart=adaptedObj=>{let xhr=new XMLHttpRequest;const url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",adaptedObj.token),formData.append("wsfunction","report_dailyattendance_get_list_courses"),formData.append("moodlewsrestformat","json"),formData.append("params[0][orderby]",adaptedObj.orderby),formData.append("params[0][order]",adaptedObj.order),formData.append("params[0][page]",adaptedObj.page),formData.append("params[0][startdate]",adaptedObj.sdv),formData.append("params[0][enddate]",adaptedObj.edv),formData.append("params[0][groupid]",adaptedObj.vv),formData.append("params[0][billid]",adaptedObj.bv),formData.append("params[0][attendanceStatus][statusPresent]",adaptedObj.attStatus.attPv),formData.append("params[0][attendanceStatus][statusAbsent]",adaptedObj.attStatus.attAv),formData.append("params[0][attendanceStatus][statusLate]",adaptedObj.attStatus.attLv),formData.append("params[0][attendanceStatus][statusExcused]",adaptedObj.attStatus.attEv),formData.append("params[0][offset]",adaptedObj.ofv),formData.append("params[0][customerid]",adaptedObj.cv),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr,adaptedObj.orderby,adaptedObj.order,adaptedObj.page,adaptedObj.ofv,adaptedObj.showCustomerSelect,adaptedObj.cv,adaptedObj.token)},xhr.onloadstart=event=>{showLoader(event)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onloadend=event=>{hideLoader(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=(myXhr,orderby,order,page,ofv,showCustomerSelect,customerid,token)=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response),formattedData={showCustomerSelect:showCustomerSelect,customerid:customerid,attendance_list:res[0].attendance_list,num_records:res[0].attendance_list.length,num_total_records:res[0].num_total_records,order:"ASC"===res[0].order,orderby:orderby,activepagenumber:page,offset:ofv,pages:truncateArrayWithActiveMiddle(res[0].pages,3),totalPages:res[0].pages.length,orderbydate:res[0].orderbydate,orderbybillid:res[0].orderbybillid,orderbygroup:res[0].orderbygroup,orderbyname:res[0].orderbyname,orderbylastname:res[0].orderbylastname,orderbydescription:res[0].orderbydescription,orderbywbs:res[0].orderbywbs,token:token,barsize:res[0].pages.length<=3?"small":"large",previous:[{page:page-1<1?page:page-1,url:window.location.href}],next:[{page:page+1<res[0].pages.length?page:page+1,url:window.location.href}],first:[{page:1,url:window.location.href}],last:[{page:res[0].pages.length,url:window.location.href}]};response=formattedData,_templates.default.renderForPromise("report_dailyattendance/content-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js);const pages=document.querySelectorAll(".pagination>li a"),customerid=document.querySelector("#customerid"),sd=document.querySelector("#startdate"),ed=document.querySelector("#enddate"),group=document.querySelector("#selgroupid"),billid=document.querySelector("#billid"),attP=document.querySelector("#chkPresent"),attA=document.querySelector("#chkAbsent"),attL=document.querySelector("#chkLate"),attE=document.querySelector("#chkExcused"),ordenablefield=document.querySelectorAll(".orderby"),order=response.order?"ASC":"DESC",showCustomerSelect=response.showCustomerSelect,offset=response.offset,valuesObj={order:order,orderby:response.orderby,page:response.activepagenumber,offset:offset,showCustomerSelect:showCustomerSelect,token:response.token,pages:pages,customerid:customerid,startdate:sd,enddate:ed,group:group,billid:billid,attP:attP,attA:attA,attL:attL,attE:attE,ordenablefield:ordenablefield};ordenablefield.forEach((element=>{element.addEventListener("click",(e=>{e.preventDefault();const page=1;valuesObj.orderby===e.target.dataset.value&&(valuesObj.order="ASC"===valuesObj.order?"DESC":"ASC");const orderby=e.target.dataset.value;valuesObj.orderby=orderby,valuesObj.page=page,processRequest(valuesObj)}))}),valuesObj),pages.forEach((elem=>{elem.addEventListener("click",(e=>{document.querySelectorAll(".pagination>li").forEach((elem=>{elem.classList.remove("active")})),window.console.log("paginacion"),e.preventDefault();let pageval=valuesObj.page;/First/.test(e.target.text)&&(pageval=1),/Last/.test(e.target.text)&&(pageval=response.totalPages),/\d/.test(e.target.text)&&(pageval=parseInt(e.target.text)),"Next page"===e.target.closest("a").attributes["aria-label"].value&&(pageval=valuesObj.page+1<=response.totalPages?valuesObj.page+1:valuesObj.page),"Previous page"===e.target.closest("a").attributes["aria-label"].value&&(pageval=valuesObj.page-1<1?valuesObj.page:valuesObj.page-1),valuesObj.page=pageval,processRequest(valuesObj)}))}),valuesObj)})).catch((error=>(0,_notification.exception)(error)))}var response},showLoader=event=>{const loader=document.querySelector(".loader");loader.classList.remove("hide"),loader.classList.add("show")},onProgressFunction=event=>{console.log("Uploaded ".concat(event.loaded," of ").concat(event.total))},hideLoader=event=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("show"),loader.classList.add("hide"),table.classList.remove("hide")};function truncateArrayWithActiveMiddle(arr,maxLength){const activeIndex=arr.indexOf(arr.find((item=>item.active)));if(-1===activeIndex||arr.length<=maxLength)return arr;const halfLength=Math.floor(maxLength/2),beforeLength=Math.min(halfLength,activeIndex),afterLength=Math.min(halfLength,arr.length-activeIndex-1),truncatedArray=[];for(let i=activeIndex-beforeLength;i<=activeIndex+afterLength;i++)i>=0&&i<arr.length&&truncatedArray.push(arr[i]);return truncatedArray}}));

//# sourceMappingURL=init.min.js.map