define("report_coursereport/ordenable",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{const links=document.querySelectorAll(".orderby"),page_link=document.querySelectorAll(".page-link");links.forEach((elem=>{elem.addEventListener("click",(e=>{e.preventDefault(),"false"===e.target.dataset.order?e.target.dataset.order="true":e.target.dataset.order="false";const order=e.target.dataset.order,activePage=document.querySelector(".page-item.active a"),pageNumber=/\d+/.exec(activePage.textContent);requestDataToServer(e.target.dataset.value,order,pageNumber)}))})),page_link.forEach((elem=>{elem.addEventListener("click",(e=>{e.preventDefault();const selectedPage=e.target.textContent,pageNumber=/\d+/.exec(selectedPage),elements=document.querySelectorAll(".orderby");let elementoOrdenacion="shortname",order=!1;for(const element of elements)if(element.textContent.includes("↑")||element.textContent.includes("↓")){elementoOrdenacion=element.dataset.value,order=element.dataset.order;break}requestDataToServer(elementoOrdenacion,order,pageNumber)}))}))};const requestDataToServer=(orderValue,orderDirection,selectedPage)=>{const customerSel=document.querySelector("#id_customer");customerid=null===customerSel?-1:customerSel.value;const role=document.querySelector("#id_role"),groupSel=document.querySelector("#id_grouptrainee"),selListTrainees=document.querySelector("#id_list_trainees"),selListCourses=document.querySelector("#id_list_courses"),startdate_day=document.querySelector("#id_startdate_day"),startdate_month=document.querySelector("#id_startdate_month"),startdate_year=document.querySelector("#id_startdate_year"),startdate=Math.floor(new Date(startdate_year.value+"."+startdate_month.value+"."+startdate_day.value).getTime()/1e3),queryType=document.querySelector('input[type="radio"][name="status"]:checked'),token=document.querySelector('input[name="token"]').value,xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","report_coursereport_get_assessment"),formData.append("moodlewsrestformat","json"),formData.append("params[0][role]",role.value),formData.append("params[0][customerid]",customerid),formData.append("params[0][groupid]",groupSel.value),formData.append("params[0][billid]",selListTrainees.value),formData.append("params[0][wbs]",selListCourses.value),formData.append("params[0][startdate]",startdate),formData.append("params[0][offset]",100),formData.append("params[0][order]",orderDirection),formData.append("params[0][orderby]",orderValue),formData.append("params[0][queryType]",queryType.value),formData.append("params[0][page]",selectedPage),window.console.log(groupSel.value,selListTrainees.value,selListCourses.value,startdate),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=myXhr=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);res[0].assessment_list=res[0].assessment_list.map((obj=>(obj.assessment=1*obj.assessment,obj.assessment=obj.assessment.toFixed(2),obj.attendance=1*obj.attendance,obj.attendance=obj.attendance.toFixed(2),obj))),response=res[0],_templates.default.renderForPromise("report_coursereport/content-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js)})).catch((error=>(0,_notification.exception)(error)))}var response}}));

//# sourceMappingURL=ordenable.min.js.map