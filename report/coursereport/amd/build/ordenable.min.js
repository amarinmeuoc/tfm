define("report_coursereport/ordenable",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{const links=document.querySelectorAll(".orderby"),page_link=document.querySelectorAll(".page-link");links.forEach((elem=>{elem.addEventListener("click",(e=>{e.preventDefault(),"false"===e.target.dataset.order?e.target.dataset.order="true":e.target.dataset.order="false";const order=e.target.dataset.order,activePage=document.querySelector(".page-item.active a"),pageNumber=/\d+/.exec(activePage.textContent);requestDataToServer(e.target.dataset.value,order,pageNumber)}))})),page_link.forEach((elem=>{elem.addEventListener("click",(e=>{e.preventDefault();const selectedPage=e.target.closest("a").getAttribute("aria-label"),pageNumber=/\d+/.exec(selectedPage),elements=document.querySelectorAll(".orderby");let elementoOrdenacion="shortname",order=!1;for(const element of elements)if(element.textContent.includes("↑")||element.textContent.includes("↓")){elementoOrdenacion=element.dataset.value,order=element.dataset.order;break}requestDataToServer(elementoOrdenacion,order,pageNumber)}))}))};const requestDataToServer=(orderValue,orderDirection,selectedPage)=>{const customerSel=document.querySelector("#id_customer");customerid=null===customerSel?-1:customerSel.value;const role=document.querySelector("#id_role"),groupSel=document.querySelector("#id_grouptrainee"),selListTrainees=document.querySelector("#fitem_id_list_trainees>div:nth-child(2)>div:nth-child(4)>span");let listTrainees="";null!==selListTrainees&&selListTrainees.hasAttribute("data-value")&&(listTrainees=selListTrainees.attributes["data-value"].value);let listCourses="";const selListCourses=document.querySelector("#fitem_id_list_courses>div:nth-child(2)>div:nth-child(4)>span");null!==selListCourses&&selListCourses.hasAttribute("data-value")&&(listCourses=selListCourses.attributes["data-value"].value);const startdate_day=document.querySelector("#id_startdate_day"),startdate_month=document.querySelector("#id_startdate_month"),startdate_year=document.querySelector("#id_startdate_year"),startdate=Math.floor(new Date(startdate_year.value+"."+startdate_month.value+"."+startdate_day.value).getTime()/1e3),queryType=document.querySelector('input[type="radio"][name="status"]:checked'),token=document.querySelector('input[name="token"]').value,xhr=new XMLHttpRequest,url=window.location.protocol+"//"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","report_coursereport_get_assessment"),formData.append("moodlewsrestformat","json"),formData.append("params[0][role]",role.value),formData.append("params[0][customerid]",customerid),formData.append("params[0][groupid]",groupSel.value),formData.append("params[0][billid]",listTrainees),formData.append("params[0][wbs]",listCourses),formData.append("params[0][startdate]",startdate),formData.append("params[0][offset]",50),formData.append("params[0][order]",orderDirection),formData.append("params[0][orderby]",orderValue),formData.append("params[0][queryType]",queryType.value),formData.append("params[0][page]",selectedPage[0]),window.console.log(groupSel.value,selListTrainees.value,selListCourses.value,startdate),setTimeout((()=>{xhr.send(formData)}),100),xhr.onloadstart=event=>{showLoader(event)},xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onloadend=event=>{hideLoader(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},showLoader=event=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("hide"),loader.classList.add("show"),table.classList.add("hide")},hideLoader=event=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("show"),loader.classList.add("hide"),table.classList.remove("hide")},onLoadFunction=myXhr=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);res[0].assessment_list=res[0].assessment_list.map((obj=>(obj.assessment=1*obj.assessment,obj.assessment=obj.assessment.toFixed(2),obj.attendance=1*obj.attendance,obj.attendance=obj.attendance.toFixed(2),obj))),res[0].pages=function(arr,maxLength){const activeIndex=arr.indexOf(arr.find((item=>item.active)));if(-1===activeIndex||arr.length<=maxLength)return arr;const halfLength=Math.floor(maxLength/2),beforeLength=Math.min(halfLength,activeIndex),afterLength=Math.min(halfLength,arr.length-activeIndex-1),truncatedArray=[];for(let i=activeIndex-beforeLength;i<=activeIndex+afterLength;i++)i>=0&&i<arr.length&&truncatedArray.push(arr[i]);return truncatedArray}(res[0].pages,8),response=res[0],_templates.default.renderForPromise("report_coursereport/content-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js)})).catch((error=>(0,_notification.exception)(error)))}var response}}));

//# sourceMappingURL=ordenable.min.js.map