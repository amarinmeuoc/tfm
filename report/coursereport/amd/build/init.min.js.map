{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const loadTemplate = () => {\n    requestDataToServer();\n    \n    const bosubmit=document.querySelector('#id_bosubmit');\n    \n    bosubmit.addEventListener('click',()=>{\n      requestDataToServer();\n    })\n}\n\nconst requestDataToServer= ()=>{\n    const customerSel=document.querySelector('#id_customer');\n    if (customerSel===null)\n        customerid=-1;\n    else\n        customerid=customerSel.value;\n    const role=document.querySelector('#id_role');\n    const groupSel=document.querySelector('#id_grouptrainee');\n    const selListTrainees=document.querySelector('#fitem_id_list_trainees>div:nth-child(2)>div:nth-child(4)>span');\n    let listTrainees=\"\";\n    if (selListTrainees!==null)\n      if (selListTrainees.hasAttribute('data-value'))\n        listTrainees=selListTrainees.attributes['data-value'].value;\n    \n    let listCourses=\"\";\n    const selListCourses=document.querySelector('#fitem_id_list_courses>div:nth-child(2)>div:nth-child(4)>span');\n    if (selListCourses!==null)\n      if (selListCourses.hasAttribute('data-value'))\n        listCourses=selListCourses.attributes['data-value'].value;\n   \n    const startdate_day=document.querySelector('#id_startdate_day');\n    const startdate_month=document.querySelector('#id_startdate_month');\n    const startdate_year=document.querySelector('#id_startdate_year');\n    const startdate=Math.floor(new Date(startdate_year.value+'.'+startdate_month.value+'.'+startdate_day.value).getTime()/1000);\n    const queryType=document.querySelector('input[type=\"radio\"][name=\"status\"]:checked');\n     \n   \n    const token=document.querySelector('input[name=\"token\"]').value;\n    const xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n    //const roleValue=(role.value===1)?true:false;\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_coursereport_get_assessment');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][role]',role.value);\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][groupid]',groupSel.value);\n    formData.append('params[0][billid]',listTrainees);\n    formData.append('params[0][wbs]',listCourses);\n    formData.append('params[0][startdate]',startdate);\n    formData.append('params[0][offset]',50);\n    formData.append('params[0][order]',1);\n    formData.append('params[0][orderby]','shortname');\n    formData.append('params[0][queryType]',queryType.value);\n    formData.append('params[0][page]',1);\n\n    \n\n    setTimeout(()=> {xhr.send(formData);},100);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr);\n        };\n    xhr.onloadstart = (event)=>{\n      showLoader(event);\n    }\n      xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n      } \n    xhr.onloadend = (event) => {\n      hideLoader(event);\n    }\n    xhr.onerror = function() {\n      window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst showLoader=(event)=>{\n  const loader=document.querySelector('.loader');\n  const table=document.querySelector('.generaltable');\n  loader.classList.remove('hide');\n  loader.classList.add('show');\n  table.classList.add('hide');\n\n}\n\nconst hideLoader=(event)=>{\n  const loader=document.querySelector('.loader');\n  const table=document.querySelector('.generaltable');\n  loader.classList.remove('show');\n  loader.classList.add('hide');\n  table.classList.remove('hide');\n}\n\nconst onLoadFunction=(myXhr)=>{\n    if (myXhr.readyState=== 4 && myXhr. status === 200){\n        const res=JSON.parse(myXhr.response);\n        res[0].assessment_list=res[0].assessment_list.map(obj=>{\n          obj.assessment=obj.assessment*1;\n          obj.assessment= obj.assessment.toFixed(2);\n          obj.attendance=obj.attendance*1;\n          obj.attendance= obj.attendance.toFixed(2);\n          return obj;\n        });\n        \n        res[0].pages=truncateArrayWithActiveMiddle(res[0].pages,8);\n        window.console.log(res[0]);\n        showTemplateAssessment(res[0]);\n        \n    }\n}\n\nfunction showTemplateAssessment(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_coursereport/content-ajax',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n    })\n    .catch((error)=>displayException(error));\n  }\n\n\n  function truncateArrayWithActiveMiddle(arr, maxLength) {\n    const activeIndex = arr.indexOf(arr.find(item => item.active)); // Combine find and indexOf\n  \n    // Handle cases where there's no active element or less than maxLength elements\n    if (activeIndex === -1 || arr.length <= maxLength) {\n      return arr;\n    }\n  \n    // Similar logic to calculate before and after lengths\n    const halfLength = Math.floor(maxLength / 2);\n    const beforeLength = Math.min(halfLength, activeIndex);\n    const afterLength = Math.min(halfLength, arr.length - activeIndex - 1);\n  \n    // Use a loop to iterate and build the truncated array\n    const truncatedArray = [];\n    for (let i = activeIndex - beforeLength; i <= activeIndex + afterLength; i++) {\n      if (i >= 0 && i < arr.length) { // Ensure we stay within array bounds\n        truncatedArray.push(arr[i]);\n      }\n    }\n  \n    return truncatedArray;\n  }"],"names":["requestDataToServer","document","querySelector","addEventListener","customerSel","customerid","value","role","groupSel","selListTrainees","listTrainees","hasAttribute","attributes","listCourses","selListCourses","startdate_day","startdate_month","startdate_year","startdate","Math","floor","Date","getTime","queryType","token","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","setTimeout","send","onload","event","onLoadFunction","onloadstart","showLoader","onprogress","onProgressFunction","onloadend","hideLoader","onerror","console","log","loader","table","classList","remove","add","myXhr","readyState","status","res","JSON","parse","response","assessment_list","map","obj","assessment","toFixed","attendance","pages","arr","maxLength","activeIndex","indexOf","find","item","active","length","halfLength","beforeLength","min","afterLength","truncatedArray","i","push","truncateArrayWithActiveMiddle","renderForPromise","then","_ref","html","js","content","innerHTML","appendNodeContents","catch","error"],"mappings":"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"}