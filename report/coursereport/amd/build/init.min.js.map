{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const loadTemplate = () => {\n    requestDataToServer();\n    \n    const bosubmit=document.querySelector('#id_bosubmit');\n    \n    bosubmit.addEventListener('click',()=>{\n      requestDataToServer();\n    })\n}\n\nconst requestDataToServer= ()=>{\n    const customerSel=document.querySelector('#id_customer');\n    if (customerSel===null)\n        customerid=-1;\n    else\n        customerid=customerSel.value;\n    const role=document.querySelector('#id_role');\n    const groupSel=document.querySelector('#id_grouptrainee');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n    const selListCourses=document.querySelector('#id_list_courses');\n    const startdate_day=document.querySelector('#id_startdate_day');\n    const startdate_month=document.querySelector('#id_startdate_month');\n    const startdate_year=document.querySelector('#id_startdate_year');\n    const startdate=Math.floor(new Date(startdate_year.value+'.'+startdate_month.value+'.'+startdate_day.value).getTime()/1000);\n    const queryType=document.querySelector('input[type=\"radio\"][name=\"status\"]:checked');\n    \n   \n    const token=document.querySelector('input[name=\"token\"]').value;\n    const xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n    //const roleValue=(role.value===1)?true:false;\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_coursereport_get_assessment');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][role]',role.value);\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][groupid]',groupSel.value);\n    formData.append('params[0][billid]',selListTrainees.value);\n    formData.append('params[0][wbs]',selListCourses.value);\n    formData.append('params[0][startdate]',startdate);\n    formData.append('params[0][offset]',100);\n    formData.append('params[0][order]',1);\n    formData.append('params[0][orderby]','shortname');\n    formData.append('params[0][queryType]',queryType.value);\n    formData.append('params[0][page]',1);\n\n    \n\n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr);\n        };\n      xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n      } \n      xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n      };\n}\n\nconst onLoadFunction=(myXhr)=>{\n    if (myXhr.readyState=== 4 && myXhr. status === 200){\n        const res=JSON.parse(myXhr.response);\n        res[0].assessment_list=res[0].assessment_list.map(obj=>{\n          obj.assessment=obj.assessment*1;\n          obj.assessment= obj.assessment.toFixed(2);\n          obj.attendance=obj.attendance*1;\n          obj.attendance= obj.attendance.toFixed(2);\n          return obj;\n        })\n        showTemplateAssessment(res[0]);\n        \n    }\n}\n\nfunction showTemplateAssessment(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_coursereport/content-ajax',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n    })\n    .catch((error)=>displayException(error));\n  }"],"names":["requestDataToServer","document","querySelector","addEventListener","customerSel","customerid","value","role","groupSel","selListTrainees","selListCourses","startdate_day","startdate_month","startdate_year","startdate","Math","floor","Date","getTime","queryType","token","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","console","log","myXhr","readyState","status","res","JSON","parse","response","assessment_list","map","obj","assessment","toFixed","attendance","renderForPromise","then","_ref","html","js","content","innerHTML","appendNodeContents","catch","error"],"mappings":"iTAE4B,KACxBA,sBAEeC,SAASC,cAAc,gBAE7BC,iBAAiB,SAAQ,KAChCH,gCAIAA,oBAAqB,WACjBI,YAAYH,SAASC,cAAc,gBAErCG,WADc,OAAdD,aACY,EAEDA,YAAYE,YACrBC,KAAKN,SAASC,cAAc,YAC5BM,SAASP,SAASC,cAAc,oBAChCO,gBAAgBR,SAASC,cAAc,qBACvCQ,eAAeT,SAASC,cAAc,oBACtCS,cAAcV,SAASC,cAAc,qBACrCU,gBAAgBX,SAASC,cAAc,uBACvCW,eAAeZ,SAASC,cAAc,sBACtCY,UAAUC,KAAKC,MAAM,IAAIC,KAAKJ,eAAeP,MAAM,IAAIM,gBAAgBN,MAAM,IAAIK,cAAcL,OAAOY,UAAU,KAChHC,UAAUlB,SAASC,cAAc,8CAGjCkB,MAAMnB,SAASC,cAAc,uBAAuBI,MACpDe,IAAI,IAAIC,eACRC,IAAIC,OAAOC,SAASC,SAAS,KAAKF,OAAOC,SAASE,SAAS,8BACjEN,IAAIO,KAAK,OAAOL,KAAI,SAEdM,SAAS,IAAIC,SACnBD,SAASE,OAAO,UAAUX,OAC1BS,SAASE,OAAO,aAAa,sCAC7BF,SAASE,OAAO,qBAAqB,QACrCF,SAASE,OAAO,kBAAkBxB,KAAKD,OACvCuB,SAASE,OAAO,wBAAwB1B,YACxCwB,SAASE,OAAO,qBAAqBvB,SAASF,OAC9CuB,SAASE,OAAO,oBAAoBtB,gBAAgBH,OACpDuB,SAASE,OAAO,iBAAiBrB,eAAeJ,OAChDuB,SAASE,OAAO,uBAAuBjB,WACvCe,SAASE,OAAO,oBAAoB,KACpCF,SAASE,OAAO,mBAAmB,GACnCF,SAASE,OAAO,qBAAqB,aACrCF,SAASE,OAAO,uBAAuBZ,UAAUb,OACjDuB,SAASE,OAAO,kBAAkB,GAIlCV,IAAIW,KAAKH,UACTR,IAAIY,OAAUC,QACVC,eAAed,MAEjBA,IAAIe,WAAcF,QAChBG,mBAAmBH,QAErBb,IAAIiB,QAAU,WACZd,OAAOe,QAAQC,IAAI,uBAIrBL,eAAgBM,WACM,IAApBA,MAAMC,YAAqC,MAAlBD,MAAOE,OAAe,OACzCC,IAAIC,KAAKC,MAAML,MAAMM,UAC3BH,IAAI,GAAGI,gBAAgBJ,IAAI,GAAGI,gBAAgBC,KAAIC,MAChDA,IAAIC,WAA0B,EAAfD,IAAIC,WACnBD,IAAIC,WAAYD,IAAIC,WAAWC,QAAQ,GACvCF,IAAIG,WAA0B,EAAfH,IAAIG,WACnBH,IAAIG,WAAYH,IAAIG,WAAWD,QAAQ,GAChCF,OAOeH,SALDH,IAAI,sBAOrBU,iBAAiB,mCAAmCP,UAC7DQ,MAAKC,WAACC,KAACA,KAADC,GAAMA,eACPC,QAAQ1D,SAASC,cAAc,YACrCyD,QAAQC,UAAU,sBACNC,mBAAmBF,QAAQF,KAAKC,OAE3CI,OAAOC,QAAQ,2BAAiBA,aARLhB"}