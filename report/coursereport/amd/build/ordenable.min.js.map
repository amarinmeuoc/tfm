{"version":3,"file":"ordenable.min.js","sources":["../src/ordenable.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const init = () => {\n    \n    const links=document.querySelectorAll('.orderby');\n    const page_link=document.querySelectorAll('.page-link');\n    \n    links.forEach((elem)=>{\n        elem.addEventListener('click',(e)=>{\n            e.preventDefault();\n            \n            if (e.target.dataset.order==='false')\n                e.target.dataset.order='true'\n            else\n                e.target.dataset.order='false'\n            const order=e.target.dataset.order;\n            const activePage=document.querySelector('.page-item.active a');\n            const pageNumber=/\\d+/.exec(activePage.textContent);\n            requestDataToServer(e.target.dataset.value,order,pageNumber);\n        })\n    })\n\n    page_link.forEach((elem)=>{\n        elem.addEventListener('click',(e)=>{\n            e.preventDefault();\n            \n            const selectedPage=e.target.textContent;\n            const pageNumber=/\\d+/.exec(selectedPage);\n            const elements = document.querySelectorAll(\".orderby\"); // Change \"span\" to the element type you expect\n            let elementoOrdenacion='shortname';\n            let order=false;\n            for (const element of elements) {\n                if (element.textContent.includes(\"↑\") || element.textContent.includes(\"↓\")) {\n                    // You've found the element\n                    \n                    elementoOrdenacion=element.dataset.value;\n                    order=element.dataset.order;\n                    break; // Exit the loop once found (optional)\n                }\n            }\n            \n            requestDataToServer(elementoOrdenacion,order,pageNumber);\n        })\n    })\n}\n\nconst requestDataToServer= (orderValue,orderDirection,selectedPage)=>{\n    const customerSel=document.querySelector('#id_customer');\n    if (customerSel===null)\n        customerid=-1;\n    else\n        customerid=customerSel.value;\n    const role=document.querySelector('#id_role');\n    const groupSel=document.querySelector('#id_grouptrainee');\n    const selListTrainees=document.querySelector('#id_list_trainees');\n    const selListCourses=document.querySelector('#id_list_courses');\n    const startdate_day=document.querySelector('#id_startdate_day');\n    const startdate_month=document.querySelector('#id_startdate_month');\n    const startdate_year=document.querySelector('#id_startdate_year');\n    const startdate=Math.floor(new Date(startdate_year.value+'.'+startdate_month.value+'.'+startdate_day.value).getTime()/1000);\n    const queryType=document.querySelector('input[type=\"radio\"][name=\"status\"]:checked');\n    \n   \n    const token=document.querySelector('input[name=\"token\"]').value;\n    const xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n    //const roleValue=(role.value===1)?true:false;\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_coursereport_get_assessment');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][role]',role.value);\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][groupid]',groupSel.value);\n    formData.append('params[0][billid]',selListTrainees.value);\n    formData.append('params[0][wbs]',selListCourses.value);\n    formData.append('params[0][startdate]',startdate);\n    formData.append('params[0][offset]',100);\n    formData.append('params[0][order]',orderDirection);\n    formData.append('params[0][orderby]',orderValue);\n    formData.append('params[0][queryType]',queryType.value);\n    formData.append('params[0][page]',selectedPage);\n\n\n    window.console.log(groupSel.value, selListTrainees.value, selListCourses.value, startdate);\n\n\n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr);\n        };\n      xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n      } \n      xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n      };\n}\n\nconst onLoadFunction=(myXhr)=>{\n    if (myXhr.readyState=== 4 && myXhr. status === 200){\n        const res=JSON.parse(myXhr.response);\n        res[0].assessment_list=res[0].assessment_list.map(obj=>{\n            obj.assessment=obj.assessment*1;\n            obj.assessment= obj.assessment.toFixed(2);\n            obj.attendance=obj.attendance*1;\n            obj.attendance= obj.attendance.toFixed(2);\n            return obj;\n          })\n        showTemplateAssessment(res[0]);\n        \n    }\n}\n\nfunction showTemplateAssessment(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_coursereport/content-ajax',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n      \n    })\n    .catch((error)=>displayException(error));\n  }"],"names":["links","document","querySelectorAll","page_link","forEach","elem","addEventListener","e","preventDefault","target","dataset","order","activePage","querySelector","pageNumber","exec","textContent","requestDataToServer","value","selectedPage","elements","elementoOrdenacion","element","includes","orderValue","orderDirection","customerSel","customerid","role","groupSel","selListTrainees","selListCourses","startdate_day","startdate_month","startdate_year","startdate","Math","floor","Date","getTime","queryType","token","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","console","log","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","myXhr","readyState","status","res","JSON","parse","response","assessment_list","map","obj","assessment","toFixed","attendance","renderForPromise","then","_ref","html","js","content","innerHTML","appendNodeContents","catch","error"],"mappings":"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"}