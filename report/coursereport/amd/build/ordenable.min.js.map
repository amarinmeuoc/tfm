{"version":3,"file":"ordenable.min.js","sources":["../src/ordenable.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nexport const init = () => {\n    \n    const links=document.querySelectorAll('.orderby');\n    const page_link=document.querySelectorAll('.page-link');\n    \n    links.forEach((elem)=>{\n        elem.addEventListener('click',(e)=>{\n            e.preventDefault();\n            \n            if (e.target.dataset.order==='false')\n                e.target.dataset.order='true'\n            else\n                e.target.dataset.order='false'\n            const order=e.target.dataset.order;\n            const activePage=document.querySelector('.page-item.active a');\n            const pageNumber=/\\d+/.exec(activePage.textContent);\n            requestDataToServer(e.target.dataset.value,order,pageNumber);\n        })\n    })\n\n    page_link.forEach((elem)=>{\n        elem.addEventListener('click',(e)=>{\n            e.preventDefault();\n            \n            const selectedPage=e.target.closest('a').getAttribute('aria-label');\n            const pageNumber=/\\d+/.exec(selectedPage);\n            const elements = document.querySelectorAll(\".orderby\"); // Change \"span\" to the element type you expect\n            let elementoOrdenacion='shortname';\n            let order=false;\n            for (const element of elements) {\n                if (element.textContent.includes(\"↑\") || element.textContent.includes(\"↓\")) {\n                    // You've found the element\n                    \n                    elementoOrdenacion=element.dataset.value;\n                    order=element.dataset.order;\n                    break; // Exit the loop once found (optional)\n                }\n            }\n            \n            requestDataToServer(elementoOrdenacion,order,pageNumber);\n        })\n    })\n}\n\nconst requestDataToServer= (orderValue,orderDirection,selectedPage)=>{\n    const customerSel=document.querySelector('#id_customer');\n    if (customerSel===null)\n        customerid=-1;\n    else\n        customerid=customerSel.value;\n    const role=document.querySelector('#id_role');\n    const groupSel=document.querySelector('#id_grouptrainee');\n    const selListTrainees=document.querySelector('#fitem_id_list_trainees>div:nth-child(2)>div:nth-child(4)>span');\n    let listTrainees=\"\";\n    if (selListTrainees!==null)\n      if (selListTrainees.hasAttribute('data-value'))\n        listTrainees=selListTrainees.attributes['data-value'].value;\n    \n    let listCourses=\"\";\n    const selListCourses=document.querySelector('#fitem_id_list_courses>div:nth-child(2)>div:nth-child(4)>span');\n    if (selListCourses!==null)\n      if (selListCourses.hasAttribute('data-value'))\n        listCourses=selListCourses.attributes['data-value'].value;\n    const startdate_day=document.querySelector('#id_startdate_day');\n    const startdate_month=document.querySelector('#id_startdate_month');\n    const startdate_year=document.querySelector('#id_startdate_year');\n    const startdate=Math.floor(new Date(startdate_year.value+'.'+startdate_month.value+'.'+startdate_day.value).getTime()/1000);\n    const queryType=document.querySelector('input[type=\"radio\"][name=\"status\"]:checked');\n    \n   \n    const token=document.querySelector('input[name=\"token\"]').value;\n    const xhr=new XMLHttpRequest();\n    const url=window.location.protocol+'//'+window.location.hostname+'/webservice/rest/server.php';\n    xhr.open('POST',url,true);\n    //const roleValue=(role.value===1)?true:false;\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_coursereport_get_assessment');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][role]',role.value);\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][groupid]',groupSel.value);\n    formData.append('params[0][billid]',listTrainees);\n    formData.append('params[0][wbs]',listCourses);\n    formData.append('params[0][startdate]',startdate);\n    formData.append('params[0][offset]',50);\n    formData.append('params[0][order]',orderDirection);\n    formData.append('params[0][orderby]',orderValue);\n    formData.append('params[0][queryType]',queryType.value);\n    formData.append('params[0][page]',selectedPage[0]);\n\n\n    window.console.log(groupSel.value, selListTrainees.value, selListCourses.value, startdate);\n\n    setTimeout(()=>{\n        xhr.send(formData);\n    },100);\n    xhr.onloadstart=(event)=>{\n        showLoader(event);\n    }\n    \n    xhr.onload = (event) =>{\n        onLoadFunction(xhr);\n        };\n      xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n      } \n      xhr.onloadend=(event)=>{\n        hideLoader(event);\n      }\n      xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n      };\n}\n\nconst showLoader=(event)=>{\n    const loader=document.querySelector('.loader');\n    const table=document.querySelector('.generaltable');\n    loader.classList.remove('hide');\n    loader.classList.add('show');\n    table.classList.add('hide');\n  \n  }\n  \n  const hideLoader=(event)=>{\n    const loader=document.querySelector('.loader');\n    const table=document.querySelector('.generaltable');\n    loader.classList.remove('show');\n    loader.classList.add('hide');\n    table.classList.remove('hide');\n  }\n\nconst onLoadFunction=(myXhr)=>{\n    if (myXhr.readyState=== 4 && myXhr. status === 200){\n        const res=JSON.parse(myXhr.response);\n        res[0].assessment_list=res[0].assessment_list.map(obj=>{\n            obj.assessment=obj.assessment*1;\n            obj.assessment= obj.assessment.toFixed(2);\n            obj.attendance=obj.attendance*1;\n            obj.attendance= obj.attendance.toFixed(2);\n            return obj;\n          })\n          res[0].pages=truncateArrayWithActiveMiddle(res[0].pages,8);\n        showTemplateAssessment(res[0]);\n        \n    }\n}\n\nfunction showTemplateAssessment(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('report_coursereport/content-ajax',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n      \n    })\n    .catch((error)=>displayException(error));\n  }\n\n  function truncateArrayWithActiveMiddle(arr, maxLength) {\n    const activeIndex = arr.indexOf(arr.find(item => item.active)); // Combine find and indexOf\n  \n    // Handle cases where there's no active element or less than maxLength elements\n    if (activeIndex === -1 || arr.length <= maxLength) {\n      return arr;\n    }\n  \n    // Similar logic to calculate before and after lengths\n    const halfLength = Math.floor(maxLength / 2);\n    const beforeLength = Math.min(halfLength, activeIndex);\n    const afterLength = Math.min(halfLength, arr.length - activeIndex - 1);\n  \n    // Use a loop to iterate and build the truncated array\n    const truncatedArray = [];\n    for (let i = activeIndex - beforeLength; i <= activeIndex + afterLength; i++) {\n      if (i >= 0 && i < arr.length) { // Ensure we stay within array bounds\n        truncatedArray.push(arr[i]);\n      }\n    }\n  \n    return truncatedArray;\n  }"],"names":["links","document","querySelectorAll","page_link","forEach","elem","addEventListener","e","preventDefault","target","dataset","order","activePage","querySelector","pageNumber","exec","textContent","requestDataToServer","value","selectedPage","closest","getAttribute","elements","elementoOrdenacion","element","includes","orderValue","orderDirection","customerSel","customerid","role","groupSel","selListTrainees","listTrainees","hasAttribute","attributes","listCourses","selListCourses","startdate_day","startdate_month","startdate_year","startdate","Math","floor","Date","getTime","queryType","token","xhr","XMLHttpRequest","url","window","location","protocol","hostname","open","formData","FormData","append","console","log","setTimeout","send","onloadstart","event","showLoader","onload","onLoadFunction","onprogress","onProgressFunction","onloadend","hideLoader","onerror","loader","table","classList","remove","add","myXhr","readyState","status","res","JSON","parse","response","assessment_list","map","obj","assessment","toFixed","attendance","pages","arr","maxLength","activeIndex","indexOf","find","item","active","length","halfLength","beforeLength","min","afterLength","truncatedArray","i","push","truncateArrayWithActiveMiddle","renderForPromise","then","_ref","html","js","content","innerHTML","appendNodeContents","catch","error"],"mappings":"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"}