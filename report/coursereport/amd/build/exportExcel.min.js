define("report_coursereport/exportExcel",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(XLSX,filesaver,blobutil)=>{document.querySelector("#idexport").addEventListener("click",(e=>{exportToExcel(e,XLSX,filesaver,blobutil)}))};const exportToExcel=(e,XLSX,filesaver,blobutil)=>{const token=document.querySelector('input[name="token"]').value,startdate_day=document.querySelector("#id_startdate_day"),startdate_month=document.querySelector("#id_startdate_month"),startdate_year=document.querySelector("#id_startdate_year"),startdate=Math.floor(new Date(startdate_year.value+"."+startdate_month.value+"."+startdate_day.value).getTime()/1e3),data={orderby:"startdate",customerid:document.querySelector("#id_customer").value,groupid:document.querySelector("#id_grouptrainee").value,billid:document.querySelector("#id_list_trainees").value,role:document.querySelector("#id_role").value,wbs:document.querySelector("#id_list_courses").value,startdate:startdate,queryType:document.querySelector('input[type="radio"][name="status"]:checked').value,token:token};prepareDataToSend(data)},prepareDataToSend=data=>{const xhr=new XMLHttpRequest,url="http://"+window.location.hostname+"/webservice/rest/server.php";xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",data.token),formData.append("wsfunction","report_coursereport_get_assessment"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",data.customerid),formData.append("params[0][order]",1),formData.append("params[0][orderby]",data.orderby),formData.append("params[0][groupid]",data.groupid),formData.append("params[0][billid]",data.billid),formData.append("params[0][page]",0),formData.append("params[0][offset]",100),formData.append("params[0][startdate]",data.startdate),formData.append("params[0][queryType]",data.queryType),formData.append("params[0][role]",data.role),formData.append("params[0][wbs]",data.wbs),xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=myXhr=>{const loader=document.querySelector(".loader");if(loader.classList.add(".hide"),loader.classList.remove(".show"),4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);createExcelFromJSON(res,"courseReport")}},onProgressFunction=event=>{console.log("Uploaded ".concat(event.loaded," of ").concat(event.total));const loader=document.querySelector(".loader");loader.classList.remove(".hide"),loader.classList.add(".show")},createExcelFromJSON=(res,op)=>{let listado=[];if(res[0].assessment_list.length>0){listado=res[0].assessment_list.map((elem=>{const sdate=new Date(1e3*elem.startdate),syear=sdate.getFullYear(),smonth=sdate.getMonth()+1,sday=sdate.getDate()+1;elem.startdate=new Date(syear+"-"+smonth+"-"+sday);const edate=new Date(1e3*elem.enddate),eyear=edate.getFullYear(),emonth=edate.getMonth()+1,eday=edate.getDate()+1;return elem.enddate=new Date(eyear+"-"+emonth+"-"+eday),elem.assessment=1*elem.assessment,elem.assessment=parseFloat(elem.assessment),elem.assessment=Math.round(100*elem.assessment)/100,elem.attendance=1*elem.attendance,elem.attendance=parseFloat(elem.attendance),elem.attendance=Math.round(100*elem.attendance)/100,delete elem.customerid,delete elem.groupid,Object.values(elem)})),res[0].ifobserver&&(listado=res[0].assessment_list.map((elem=>(delete elem.customercode,Object.values(elem)))));let titles=Object.keys(res[0].assessment_list[0]);listado.unshift(titles)}const wb=XLSX.utils.book_new(),dr=new Date,dateFile=dr.getDate(),month=dr.getMonth()+1,year=dr.getFullYear(),min=dr.getMinutes(),hour=dr.getHours();wb.Props={Title:"Course assessment report",Subject:"Training program report",Author:"Alberto MarÃ­n",CreateDate:new Date(year,month,dateFile)},wb.SheetNames.push("courseAssessment");const ws=XLSX.utils.aoa_to_sheet(listado);wb.Sheets.courseAssessment=ws;const wbout=XLSX.write(wb,{bookType:"xlsx",type:"binary"}),nameFile="assessmentReport"+dateFile+"."+month+"."+year+"."+hour+"."+min+".xlsx";saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}),nameFile)},s2ab=s=>{for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}}));

//# sourceMappingURL=exportExcel.min.js.map